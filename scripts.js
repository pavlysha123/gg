jQuery(function ($) {
	window.geocodeCache = new Map();
	window.routeCache = new Map();

	// Брейкпоинты
	var sizeXXL = window.matchMedia('(min-width: 1400px)');
	var sizeXL = window.matchMedia('(min-width: 1200px)');
	var sizeLG = window.matchMedia('(min-width: 992px)');
	var sizeMD = window.matchMedia('(min-width: 768px)');
	var sizeSM = window.matchMedia('(min-width: 576px)');
	var breakpoints = [sizeSM, sizeMD, sizeLG, sizeXL, sizeXXL];


	// Шапка фикс
	if (!$('.header-body.is-static').length) {
		function fixedHeader() {
			if ($(window).scrollTop() >= $('.header-body:not(.is-fixed)').outerHeight() + 200) {
				$('.header-body').addClass('is-fixed');
			} else if ($(window).scrollTop() < $('.header-body.is-fixed').outerHeight() + 200) {
				$('.header-body').removeClass('is-fixed');
			}
		}
		fixedHeader();
		$(window).on('scroll', fixedHeader);
	}


	// Выпадающее подменю со скроллом
	$('.header-menu__item--has-children > a').on('click', function (e) {
		if ($(this).siblings('ul').css('visibility') != 'visible') {
			e.preventDefault();
		}
	});
	// $('.header-menu__submenu').each(function () {
	// 	Scrollbar.init(this, {
	// 		alwaysShowTracks: true,
	// 		continuousScrolling: false
	// 	});
	// });
	$('.header-menu__item--has-children').on('mouseenter', function () {
		var $menuItem = $(this);
		var $menuLink = $menuItem.children('.header-menu__link');
		var $menuSubmenu = $menuItem.children('.header-menu__submenu');
		var $menuPlaceholder = $menuItem.children('.header-menu__placeholder');
		var $totalHeight = 0; var $newMaxHeight;
		var $windowHeight = $(window).innerHeight();
		var $headerHeight = $('.header-body').outerHeight();
		var $maxHeigth = $windowHeight - $headerHeight - 50;
		$menuSubmenu.find('li').each(function () {
			var $itemHeight = $(this).outerHeight();
			if ($totalHeight < $maxHeigth) {
				$totalHeight += $itemHeight;
			} else {
				var $overflow = $(this).prev().prev().nextAll();
				$overflow.hide();
				$newMaxHeight = $menuSubmenu.outerHeight() - 2;
				$overflow.show();
				return false;
			}
		});
		if (typeof ($newMaxHeight) != 'undefined') {
			$menuSubmenu.css('max-height', $newMaxHeight + 'px');
		} else {
			$menuSubmenu.css('max-height', '');
		}
		if (!$menuPlaceholder.length) {
			$('<div class="header-menu__placeholder"></div>').insertAfter($menuLink);
			$menuPlaceholder = $menuItem.children('.header-menu__placeholder');
		}
		$menuPlaceholder.css({
			'width': $menuLink.width() + $menuSubmenu.width(),
			'height': $menuSubmenu.outerHeight() + 12
		});
		Scrollbar.get($menuSubmenu[0]).update();
	});
	$('.header-menu').on('mouseleave', function () {
		setTimeout(() => {
			if (!$('.header-menu *:hover').length) {
				$('.header-menu__submenu[style]').removeAttr('style');
			}
		}, 300);
	});


	// Бургер-меню
	$('.header-burger').on('click', function () {
		$(this).toggleClass('is-active');
		$('.dropdown').toggleClass('is-active');
		if ($('.header-burger').hasClass('is-active')) {
			scrollLock.disablePageScroll();
		} else {
			setTimeout(function () {
				scrollLock.clearQueueScrollLocks();
				scrollLock.enablePageScroll();
			}, 400);
		}
	});
	$(sizeLG).on('change', function () {
		if ($('.dropdown.is-active').length) {
			$('.dropdown').css('transition', 'none');
			$('.header-burger, .dropdown').removeClass('is-active');
			scrollLock.clearQueueScrollLocks();
			scrollLock.enablePageScroll();
			setTimeout(function () {
				$('.dropdown').removeAttr('style');
			}, 400);
		}
	});


	// Выбор города в мобильном меню
	$('.dropdown-city__toggle').on('click', function () {
		$(this).toggleClass('is-active');
		$('.dropdown-city__list').slideToggle(200);
	});


	// Кастомный select
	$('label.select').each(function () {
		var $select = $(this);
		var $select_input = $select.find('input');
		var $select_option = $select.find('.select__option');
		$select.on('click', function (e) {
			e.stopPropagation();
			$(this).toggleClass('is-active');
			$select.not(this).removeClass('is-active');
		});
		$select_option.on('click', function () {
			var $select = $(this).closest('label.select');
			var $input = $select.find('input');
			var $value = $(this).text();
			$input.val($value).trigger('change');
			$select.removeClass('is-active');
		});
		$select_input.on('focus', function () {
			$(this).trigger('blur');
		});
	});
	$(document).on('click', function () {
		$('label.select').removeClass('is-active');
	});


	// Маска номера телефона
	$('input[type="tel"]').inputmask('+7 (999) 999-99-99', {
		showMaskOnFocus: true,
		showMaskOnHover: false,
		clearIncomplete: true
	});


	// Слайдер техники
	if ($('.catalog-slider').length) {
		new Swiper('.catalog-slider .swiper', {
			loop: false,
			slidesPerView: 1.15,
			spaceBetween: 15,
			navigation: {
				prevEl: '.catalog-slider__arrow--prev',
				nextEl: '.catalog-slider__arrow--next'
			},
			pagination: {
				el: '.catalog-slider__dots',
				type: 'bullets',
				bulletElement: 'button',
				bulletClass: 'swiper-dot',
				bulletActiveClass: 'swiper-dot--active',
				clickable: true
			},
			breakpoints: {
				576: {
					slidesPerView: 1,
					spaceBetween: 20
				},
				768: {
					slidesPerView: 2,
					spaceBetween: 20
				},
				1200: {
					slidesPerView: 3,
					spaceBetween: 20
				}
			}
		});
	}


	// Слайдер отзывов
	if ($('.reviews-slider').length) {
		new Swiper('.reviews-slider .swiper', {
			loop: false,
			slidesPerView: 1.15,
			spaceBetween: 15,
			navigation: {
				prevEl: '.reviews-slider__arrow--prev',
				nextEl: '.reviews-slider__arrow--next'
			},
			pagination: {
				el: '.reviews-slider__dots',
				type: 'bullets',
				bulletElement: 'button',
				bulletClass: 'swiper-dot',
				bulletActiveClass: 'swiper-dot--active',
				clickable: true
			},
			breakpoints: {
				576: {
					slidesPerView: 2,
					spaceBetween: 20
				},
				1200: {
					slidesPerView: 3,
					spaceBetween: 20
				}
			}
		});
	}


	// Вопрос-ответ
	$('.faq-item__question').on('click', function () {
		$(this).next().slideToggle(250).parent().toggleClass('is-active');
		$('.faq-item__question').not(this).next().slideUp(250).parent().removeClass('is-active');
	});


	// Локализация Fancybox
	$.fancybox.defaults.lang = 'ru';
	$.fancybox.defaults.i18n.ru = {
		CLOSE: 'Закрыть',
		NEXT: 'Вперед',
		PREV: 'Назад',
		ERROR: 'Не удалось загрузить контент. <br/> Повторите попытку позже.',
		PLAY_START: 'Cлайдшоу',
		PLAY_STOP: 'Остановить',
		FULL_SCREEN: 'Полный экран',
		THUMBS: 'Предпросмотр',
		DOWNLOAD: 'Скачать',
		SHARE: 'Поделиться',
		ZOOM: 'Увеличить',
	};


	// Попап-формы
	$('a[href="#order"], a[href="#request"], a[href="#calc"]').each(function () {
		var $this = $(this);
		var $thisForm = $this.attr('href');
		$this.fancybox({
			type: 'inline',
			touch: false,
			arrows: false,
			toolbar: false,
			infobar: false,
			keyboard: false,
			smallBtn: false,
			backFocus: false,
			autoFocus: false,
			animationEffect: 'drop',
			animationDuration: 450,
			beforeLoad: function () {
				if ($thisForm == '#order') {
					var $item = $this.closest('.catalog-item');
					var $itemName = $item.find('.catalog-item__name');
					var $orderInput = $('#order [name="Автомобиль"]');
					if ($itemName.length) {
						$orderInput.val($itemName.text().trim());
					} else {
						$orderInput.val('');
					}
				}
				if ($thisForm == '#request') {
					var $item = $this.closest('.product');
					var $itemName = $item.find('.product-title');
					var $orderInput = $('#request [name="Автомобиль"]');
					$orderInput.val($itemName.text().trim());
				}
				if ($thisForm == '#calc') {
					var $item = $this.closest('.product');
					var $itemName = $item.find('.product-title');
					var $itemPrice = $item.find('.product-card__price');
					var $orderInput = $('#calc [name="Автомобиль"]');
					var $orderCar = $('#calc .popup-form__order-car');
					var $orderPrice = $('#calc .popup-form__order-price');
					var $formInfo = $('#calc .popup-form__info');
					var $formOrder = $('#calc .popup-form__order');
					if ($itemName.length) {
						$orderInput.val($itemName.text().trim());
						$orderCar.text($itemName.text().trim());
						$orderPrice.text($itemPrice.text().trim());
						$formInfo.hide();
						$formOrder.show();
					} else {
						$orderInput.val('');
						$formOrder.hide();
						$formInfo.show();
					}
				}
			}
		});
	});


	// Попап-сообщения
	function popupMessage(id) {
		$.fancybox.open({
			src: '#' + id,
			type: 'inline',
			touch: false,
			arrows: false,
			toolbar: false,
			infobar: false,
			keyboard: false,
			smallBtn: false,
			backFocus: false,
			autoFocus: false,
			animationEffect: 'drop',
			animationDuration: 450
		});
	}


	// Отправка форм
	/*$('form:not(.calc-form):not(.documents)').on('submit', function () {
		var $thisForm = $(this);
		$.ajax({
			type: 'POST',
			url: mail,
			data: $thisForm.serialize()
		}).done(function () {
			if ($('.fancybox-slide form').length) {
				$.fancybox.getInstance().addContent({
					src: '#thanks'
				});
				$.fancybox.getInstance().next(450);
			} else {
				popupMessage('thanks');
			}
			setTimeout(function () {
				$thisForm.trigger('reset');
				$thisForm.find('.input--address:nth-child(n+3)').remove();
			}, 500);
		});
		return false;
	});

*/
	// Отправка формы калькулятора
	$('.calc-form').on('submit', function (e) {
		e.preventDefault()
		/*$.ajax({
			type: 'POST',
			url: mail,
			data: $(this).serialize()
		});
		return false;*/
	});


	// Показать весь контент
	if ($('.btn--readmore').length) {
		var $readMoreBtn = $('.btn--readmore');
		var $readMoreText = $readMoreBtn.parent().siblings('.content');
		var $readMoreImg = $readMoreBtn.parent().siblings('[class*="info__img"]');
		var $maxHeight = parseInt($readMoreText.css('max-height')) + 10;
		setTimeout(() => {
			if ($readMoreText[0].scrollHeight <= $maxHeight) {
				$readMoreText.removeClass('is-folded');
				$readMoreBtn.hide();
			}
		}, 10);
		$readMoreBtn.on('click', function () {
			$readMoreBtn.toggleClass('is-active');
			if ($readMoreBtn.hasClass('is-active')) {
				$readMoreBtn.trigger('blur');
				$readMoreBtn.text('Скрыть');
			} else {
				$readMoreBtn.text('Показать еще');
			}
			if ($readMoreText.hasClass('is-folded')) {
				$readMoreImg.addClass('is-sticky');
				$readMoreText.css('max-height', $readMoreText[0].scrollHeight + 'px').removeClass('is-folded');
			} else if ((!$readMoreText.hasClass('is-folded')) && ($readMoreText.attr('style') == '')) {
				$readMoreText.css('max-height', $readMoreText[0].scrollHeight + 'px');
				setTimeout(() => {
					$readMoreText.css('max-height', '').addClass('is-folded');
				}, 10);
			} else {
				$readMoreText.css('max-height', '').addClass('is-folded');
			}
		});
		$.fn.isInViewport = function () {
			var $rect = $(this)[0].getBoundingClientRect();
			return ($rect.top >= 0 && $rect.bottom <= $(window).height());
		};
		$(window).on('scroll', function () {
			if (!$readMoreBtn.hasClass('is-active') && $readMoreImg.hasClass('is-sticky')) {
				if ($readMoreImg.isInViewport()) $readMoreImg.removeClass('is-sticky');
			}
		});
		$(window).on('resize', function () {
			if ($readMoreBtn.length && $readMoreBtn.hasClass('is-active')) {
				$readMoreText.css('max-height', '');
			}
		});
	}


	// Показать всю технику в каталоге
	var $catalogGrid = $('.catalog-grid');
	if ($catalogGrid.length) {
		var $hiddenItems = null;
		function checkHiddenItems() {
			$hiddenItems = $catalogGrid.find('.catalog-item:hidden');
			if (!$hiddenItems.length) {
				$catalogGrid.addClass('no-hidden');
			} else {
				$catalogGrid.removeClass('no-hidden');
			}
		}
		checkHiddenItems();
		$(breakpoints).each(function () {
			$(this).on('change', function () {
				$catalogGrid.find('.catalog-item').css('display', '');
				checkHiddenItems();
			});
		});
		$('.catalog-showmore__btn').on('click', function () {
			$hiddenItems.fadeIn({
				start: function () {
					$(this).css('display', 'flex');
				}
			}, 300);
			checkHiddenItems();
		});
	}


	// Галерея на странице авто
	if ($('.product-card__gallery').length) {
		$('.product-card__thumb').on('click', function () {
			var $thumb = $(this);
			var $index = $thumb.index() + 1;
			if (!$thumb.hasClass('is-active')) {
				$thumb.addClass('is-active').siblings().removeClass('is-active');
				$('.product-card__photo').hide();
				$('.product-card__photo:nth-child(' + $index + ')').fadeIn(300);
			}
		});
		$().fancybox({
			loop: true,
			backFocus: false,
			selector: '.product-card__photo-link'
		});
	}


	// Формы с инпутами адреса
	if ($('.input--address').length) {
		// Данные городов
		var cities = {
			'msk': {
				center: [55.7522, 37.6156],
				bounds: [[54.767450087725074, 34.40350341796876], [56.62841404541838, 41.215026855468764]],
				city: [[[55.897702887224796, 37.67240905761718], [55.89664192633831, 37.6752414703369], [55.89591852721012, 37.67807388305662], [55.8956291637662, 37.6829662322998], [55.89538802590739, 37.687686920166], [55.89553270880329, 37.69146347045898], [55.89529157034246, 37.69669914245605], [55.89466460330075, 37.69996070861816], [55.89312125646775, 37.705282211303704], [55.89215663339145, 37.70751380920409], [55.89152961547806, 37.70957374572752], [55.89046848506115, 37.712148666381815], [55.888635554797155, 37.715324401855455], [55.8874296322104, 37.71798515319823], [55.88622367199341, 37.720216751098604], [55.88545183770592, 37.722448348999016], [55.884872951875, 37.72493743896484], [55.884872951875, 37.73025894165038], [55.88279853978146, 37.73025894165038], [55.8811582281455, 37.73111724853514], [55.880000319199695, 37.7330913543701], [55.87903536858371, 37.735065460205064], [55.87816689243558, 37.737468719482415], [55.87464453915709, 37.743562698364244], [55.86373768471359, 37.76553535461424], [55.84804765603748, 37.79574775695799], [55.833558904954586, 37.8228702545166], [55.83148173964286, 37.82776260375975], [55.83090204571783, 37.83093833923339], [55.82925953247555, 37.831968307495096], [55.824331574788744, 37.83746147155761], [55.82186736083274, 37.83866310119629], [55.81930634494508, 37.83995056152341], [55.81640687737011, 37.84115219116209], [55.815923611680155, 37.84321212768552], [55.815198701844565, 37.84458541870117], [55.814038817900894, 37.84381294250486], [55.81244392079273, 37.84252548217771], [55.81075229152879, 37.84063720703125], [55.80698210925112, 37.84106636047361], [55.80209966167469, 37.841667175292955], [55.80011750252675, 37.84192466735837], [55.780193594328715, 37.84381294250486], [55.77913351008552, 37.844783264391616], [55.77845628577709, 37.84701486229202], [55.77792417267178, 37.84813066124222], [55.776618045932416, 37.84778733848831], [55.77526349769469, 37.84581323265335], [55.773812143546046, 37.844697433703146], [55.75997317538473, 37.84426828026078], [55.753487486017335, 37.84435411094925], [55.75198691106874, 37.8441824495723], [55.74898558725352, 37.84383912681839], [55.74675864876349, 37.845555740587926], [55.7449673229946, 37.84950395225785], [55.74482207674487, 37.85173555015823], [55.74332116703625, 37.85019059776566], [55.741481263136315, 37.844869095080114], [55.736784271297495, 37.8430666506221], [55.73179612239952, 37.84289498924515], [55.731166504711425, 37.844697433703146], [55.72898698012023, 37.84177919029495], [55.72491820726679, 37.841521698229506], [55.72080056319119, 37.84092088341019], [55.71818442163351, 37.845126587145536], [55.716585581821896, 37.84435411094925], [55.71571345967627, 37.840405899279325], [55.713823794608125, 37.84135003685256], [55.7119340377362, 37.84461160301467], [55.710722606838814, 37.84461160301467], [55.709414219096786, 37.84169335960648], [55.70985035323334, 37.83731599449416], [55.70849347541899, 37.83851762413284], [55.70645806996491, 37.83971925377152], [55.70587650599171, 37.83774514793656], [55.705149538801436, 37.83551355003615], [55.70350169621928, 37.8343119203975], [55.701708376470975, 37.833110290758825], [55.69758827484921, 37.83216615318557], [55.69356469588598, 37.83156533836623], [55.6894922165988, 37.832766968004904], [55.686631530014225, 37.83499856590531], [55.684207054812255, 37.83748765587111], [55.6821703789833, 37.83499856590531], [55.680279084622, 37.834655243151396], [55.678775682559596, 37.83620019554396], [55.675235183954115, 37.83723016380569], [55.667182989135455, 37.840405899279325], [55.66053624948339, 37.84203668236037], [55.65641179002368, 37.84263749717971], [55.6535972024768, 37.84014840721388], [55.64859838232795, 37.83448358177445], [55.64529783914648, 37.83027787803908], [55.64243390621512, 37.82572885154982], [55.63913284127208, 37.824613052599645], [55.637919144215985, 37.818604904406286], [55.62854813179519, 37.80358453392288], [55.61820341705874, 37.78667588829299], [55.617086218110366, 37.78899331688187], [55.614948878859664, 37.78959413170121], [55.61509461025296, 37.7873625338008], [55.614997456051206, 37.784444290392614], [55.614997456051206, 37.78075357078811], [55.61120825360195, 37.773543792956076], [55.60217097907149, 37.75852342247268], [55.59726276567736, 37.74642129539749], [55.59342323822858, 37.736464935534215], [55.59118739019748, 37.733718353502965], [55.58875697549044, 37.73251672386429], [55.58875697549044, 37.72891183494826], [55.5889514142296, 37.72530694603226], [55.58584027831145, 37.71826882957717], [55.58345814747422, 37.7134623110225], [55.58127034840715, 37.7057375490596], [55.57845033787414, 37.69964357017777], [55.577088880670665, 37.695094543688505], [55.575532871526356, 37.692691284411154], [55.57358777301203, 37.692262130968786], [55.57120489546283, 37.69234796165726], [55.57188573243677, 37.689773041002965], [55.57266381732086, 37.68642564415238], [55.572128885626164, 37.68239160179398], [55.57057267908735, 37.67071862816117], [55.57042678154921, 37.655612426989286], [55.57086447253071, 37.645570236437536], [55.571496684188844, 37.63930459617874], [55.57208025510925, 37.63381143211625], [55.57208025510925, 37.62437005638381], [55.57266381732086, 37.621108490221694], [55.57353914430943, 37.61527200340529], [55.57383091561797, 37.61115213035842], [55.573879543957716, 37.606860595934606], [55.573101483264445, 37.603684860460966], [55.57144805288571, 37.60196824669143], [55.56896777623045, 37.60308404564163], [55.56648734226576, 37.601624923937536], [55.5659036878825, 37.59759088157914], [55.56673052902162, 37.59467263817092], [55.57008635184344, 37.593642669909215], [55.57378228721773, 37.59252687095901], [55.57601913103611, 37.58969445823929], [55.57699163191336, 37.5841154634883], [55.57854758300307, 37.577163177721715], [55.579617263456626, 37.5727858126094], [55.58039519449406, 37.569524246447294], [55.58195101012762, 37.56188531517287], [55.58972915951208, 37.530900436632834], [55.58919446129312, 37.52729554771683], [55.590652711931135, 37.52592225670121], [55.592256724782665, 37.52223153709671], [55.59313161313196, 37.5185408174922], [55.59415229144777, 37.51373429893752], [55.59677677040253, 37.50738282799025], [55.599012298609146, 37.50369210838577], [55.60192801271931, 37.49931474327346], [55.604843509200315, 37.49776979088089], [55.60722433656079, 37.494594055407255], [55.6090220079864, 37.491332489245146], [55.60790454629169, 37.48910089134476], [55.60596105848462, 37.48747010826369], [55.611256835447605, 37.488585907213896], [55.61412305735588, 37.48686929344436], [55.61834913630358, 37.48111863731642], [55.62340040051834, 37.47622628807327], [55.62786828167662, 37.47099061607619], [55.632044316744654, 37.46661325096388], [55.63592859929264, 37.46172090172073], [55.63665685921782, 37.458373504870146], [55.63626845561624, 37.45622773765824], [55.63578294567616, 37.45348115562697], [55.63811333828267, 37.455111938708036], [55.64068631839994, 37.455541092150426], [55.64660838237857, 37.44910379051468], [55.6556353723766, 37.43837495445512], [55.65903208541546, 37.43416925071975], [55.659905478070506, 37.431079345934585], [55.66063329033317, 37.42884774803421], [55.660875891400586, 37.426616150133825], [55.66330181902196, 37.429105240099624], [55.66655232529556, 37.427817779772475], [55.680279084622, 37.4175180971553], [55.688910399066174, 37.41305490135452], [55.69293445909798, 37.407990890734396], [55.698994005599275, 37.40052362083694], [55.70049662715336, 37.39691873192091], [55.702726216740054, 37.39503045677445], [55.705343398046864, 37.393142181627965], [55.70626421627299, 37.39176889061234], [55.70960805709442, 37.3874773561885], [55.71144946990421, 37.38567491173048], [55.71237014362427, 37.382413345568374], [55.712757789198164, 37.38078256248733], [55.714938223574464, 37.3838724672725], [55.718620457447926, 37.38224168419143], [55.72307743204297, 37.38009591697952], [55.72661358103612, 37.378207641833036], [55.72985880462025, 37.37657685875199], [55.72981037043872, 37.37219949363968], [55.72951976408239, 37.36653466820022], [55.73005254074289, 37.3611273348262], [55.731892985754094, 37.37134118675492], [55.734992485659596, 37.373057800524435], [55.74501573829052, 37.368680435412145], [55.751212398090566, 37.36773629783889], [55.76215096246012, 37.36799378990431], [55.76418345353268, 37.36550469993851], [55.76655455864643, 37.36610551475785], [55.76849004730127, 37.368251281969755], [55.77158662843581, 37.36567636131546], [55.77361862555876, 37.36893792747757], [55.77739205226982, 37.36893792747757], [55.7812134822765, 37.36885209678909], [55.78493780505847, 37.369023758166044], [55.787404367494126, 37.37031121849319], [55.78943553645033, 37.36885209678909], [55.791369884195, 37.36430307029983], [55.792530446538024, 37.374259430163114], [55.79562510967724, 37.377520996325224], [55.80031498774618, 37.381898361437536], [55.80442420841985, 37.38533158897659], [55.808484657453775, 37.387563186876974], [55.82303110743136, 37.39185472130082], [55.83076121703942, 37.39417214988967], [55.831727372273825, 37.39099641441603], [55.83192060042838, 37.388421493761754], [55.831775679402845, 37.38558908104201], [55.83414265491183, 37.38576074241899], [55.83568835674609, 37.38782067894242], [55.834625693362945, 37.392369705431676], [55.835640054497695, 37.39554544090529], [55.839648936077, 37.39468713402053], [55.84394715517475, 37.391940551989286], [55.84814832383642, 37.39133973716995], [55.85452164003844, 37.39460130333206], [55.85959057388015, 37.39674707054397], [55.86311429845631, 37.399665313952184], [55.866782492613076, 37.40378518699905], [55.86924384891148, 37.407733398668974], [55.8718980772097, 37.41219659446976], [55.873876565242476, 37.418204742663114], [55.875565438348396, 37.4226679384639], [55.87947369034666, 37.43477006553909], [55.88121056442022, 37.44077821373244], [55.884442872291174, 37.4417223513057], [55.88285087383534, 37.4453272402217], [55.88285087383534, 37.44970460533402], [55.882995603677216, 37.458287674181676], [55.883815729211854, 37.46661325096388], [55.885745367711415, 37.47339387535355], [55.888784352998634, 37.48257775902054], [55.889122003279596, 37.48549600242873], [55.889218474246576, 37.488500076525426], [55.89119607599798, 37.492619949572294], [55.89433109088146, 37.49450822471878], [55.894041715548205, 37.50043054222366], [55.90055213634929, 37.51373429893752], [55.90416856273664, 37.52214570640823], [55.9071096731802, 37.532445389025426], [55.90826676999187, 37.54059930443069], [55.91115936034281, 37.54471917747756], [55.90870067235796, 37.5464357912471], [55.91038802410236, 37.56274362205765], [55.91130398417253, 37.57338662742874], [55.91140039975807, 37.58248468040726], [55.91072548560348, 37.58737702965042], [55.91279839869436, 37.59055276512405], [55.90870067235796, 37.594071823351584], [55.90720609923871, 37.6005949556758], [55.90508467033431, 37.60797639488478], [55.90064857878059, 37.626687484972685], [55.89789987512875, 37.64428277611039], [55.89621197772044, 37.65990396141311], [55.89577793503864, 37.668057876818395], [55.897702887224796, 37.67240905761718]]],
				detour: ['В пределах МКАД', 'За МКАД:']
			},
			'spb': {
				center: [59.939095, 30.315868],
				bounds: [[57.819300, 28.332330], [61.785042, 34.346627]],
				city: [[[60.05628715840986, 30.116196291375097], [60.05537909118476, 30.11333707652921], [60.0488553000143, 30.117800272329994], [60.04078461079908, 30.121576822622945], [60.0370061612954, 30.12140516124605], [60.03503089007077, 30.114710367544856], [60.034000266731034, 30.110075510367125], [60.031938923262324, 30.1050973304355], [60.027901751792, 30.07848981700775], [60.01673252919261, 30.07848981700775], [60.00977132912238, 30.07917646251556], [60.004012188054794, 30.07848981700775], [60.002636721929996, 30.074541605337828], [60.00091730856464, 30.07145170055269], [59.99653239856131, 30.068533457144472], [59.99618845938772, 30.071280039175715], [59.99524792065978, 30.074582410619875], [59.99421605218188, 30.078530622289797], [59.99361411399177, 30.08539707736791], [59.994044070963014, 30.087800336645266], [59.99361411399177, 30.09209187106908], [59.992668188922465, 30.09466679172338], [59.99120625135553, 30.092950177953863], [59.99034625780794, 30.09569675998511], [59.99008825537082, 30.098271680639407], [59.991034254439995, 30.100503278539787], [59.98922823267084, 30.103249860571033], [59.988884217320745, 30.111489606664797], [59.98931423595897, 30.118871045873775], [59.988024163225056, 30.126424146459726], [59.988024163225056, 30.130887342260486], [59.988024163225056, 30.13552219943822], [59.98733610380185, 30.139470411108142], [59.98776614262333, 30.14702351169409], [59.98742211202367, 30.154233289526125], [59.98595994190583, 30.160069776342535], [59.98286336770122, 30.15732319431129], [59.98226122229627, 30.16247303561986], [59.981659065901326, 30.167451215551512], [59.98372355635853, 30.169167829321054], [59.98535785301878, 30.17157108859838], [59.98492778279992, 30.1806691415769], [59.9850998115603, 30.184960676000742], [59.98251928595839, 30.186677289770255], [59.98088484867326, 30.192513776586665], [59.98062677222664, 30.196976972387453], [59.97864811907147, 30.203156781957755], [59.97882018057788, 30.206075025365973], [59.97959444625372, 30.21019489841284], [59.978045896733576, 30.212254834936275], [59.97559387807376, 30.20873577670882], [59.971291650645064, 30.20933659152816], [59.96995784626565, 30.20933659152816], [59.969785738548765, 30.21131069736312], [59.96987179251938, 30.212340665624826], [59.96896821463889, 30.214314771459787], [59.96724704548784, 30.214915586279123], [59.96432085197136, 30.215258909033043], [59.96182477607069, 30.213628125951974], [59.960318432087014, 30.21062405185531], [59.95971587524887, 30.208907438085767], [59.95971587524887, 30.20701916293928], [59.961179208497235, 30.202126813696125], [59.962169073629624, 30.199036908910962], [59.961738701131296, 30.197491956518395], [59.96100705501025, 30.199466062353356], [59.958639853547446, 30.205817533300603], [59.95739162444846, 30.205302549169765], [59.95549766951143, 30.20392925815414], [59.952914828648254, 30.202727628515465], [59.952053836810194, 30.201354337499843], [59.95295787765105, 30.1959470041258], [59.95386189374951, 30.18787891940901], [59.9551102562577, 30.186333967016438], [59.9549811174966, 30.18401653842756], [59.954206274326545, 30.18264324741194], [59.952355186506324, 30.182557416723466], [59.95183858534404, 30.18564732150863], [59.95102061698033, 30.191312146948064], [59.95003041765969, 30.19285709934066], [59.947662429343445, 30.191312146948064], [59.94529427129054, 30.19045384006331], [59.94413165885593, 30.189166379736157], [59.94490673835764, 30.183930707739087], [59.94576791648045, 30.179553342626775], [59.945337330224724, 30.177407575414865], [59.94387329498175, 30.176892591284002], [59.94301206747768, 30.18015415744611], [59.94197856484315, 30.181527448461736], [59.940040660279976, 30.182986570165856], [59.93758581802503, 30.18538982944318], [59.93465699575933, 30.187535596655117], [59.93220175361692, 30.190368009374836], [59.93043558949765, 30.194316221044755], [59.92914321450238, 30.198436094091626], [59.92780770726728, 30.206933332250806], [59.92802311530874, 30.21070988254378], [59.92336998938686, 30.210452390478338], [59.9195349768188, 30.209765744970525], [59.91746647083104, 30.20933659152816], [59.91406177306742, 30.208649946020348], [59.9121222316088, 30.207104993627752], [59.90966531585987, 30.205560041235184], [59.90746686817101, 30.20573170261213], [59.90531138551111, 30.207534147070195], [59.90431981633758, 30.209765744970575], [59.903241990061005, 30.213198972509634], [59.901905436729116, 30.210795713232304], [59.900353242545535, 30.2085641153319], [59.89789545288712, 30.203929258154165], [59.89595496372445, 30.198693586157095], [59.8925049243661, 30.193543744848547], [59.89034846719578, 30.1922562845214], [59.88918392192819, 30.18925221042471], [59.888580067518134, 30.18487484531242], [59.888364402560335, 30.178094220922755], [59.88883886361361, 30.173030210302656], [59.88987402777113, 30.16770870761711], [59.890779769865055, 30.161099744604417], [59.89215990065636, 30.15534908847648], [59.89134045493672, 30.154662442968668], [59.89004655198476, 30.159640622900294], [59.88883886361361, 30.16624958591299], [59.88668216769619, 30.167022062109325], [59.884180224461566, 30.169940305517542], [59.8834037208903, 30.168567014501892], [59.881936942254605, 30.165477109716754], [59.88012494955994, 30.16470463352047], [59.87844229616482, 30.164103818701133], [59.875594534178646, 30.161872220800728], [59.87408425804594, 30.157666517065383], [59.872142373312236, 30.15470535831298], [59.87054562726445, 30.153203321264648], [59.86950985896031, 30.152044606970207], [59.8674166450368, 30.149855924414066], [59.86581967129768, 30.147581411169472], [59.86519380924879, 30.146293950842324], [59.86461109947694, 30.143847776220735], [59.864244202883796, 30.14217407779543], [59.86374780691163, 30.140543294714387], [59.86305715667167, 30.139170003698766], [59.862495992756465, 30.137410474584986], [59.862323325025315, 30.135650945471234], [59.86225857439425, 30.133805585668984], [59.86266865958829, 30.133247686193883], [59.863272986417385, 30.133762670324746], [59.863488814757886, 30.132990194128464], [59.86307873970948, 30.131316495703157], [59.86318665468772, 30.12972862796635], [59.86305715667167, 30.12629540042727], [59.86318665468772, 30.124149633215364], [59.86310032274224, 30.12007267551273], [59.86310032274224, 30.11693985538333], [59.86325140351505, 30.11526615695805], [59.862992407482935, 30.113463712500035], [59.862193823645725, 30.112648320959515], [59.862323325034296, 30.11123211459963], [59.862690242888014, 30.109944654272482], [59.863553562995, 30.10981590823977], [59.86376938950875, 30.107970548437496], [59.863726224318434, 30.107112241552738], [59.86314348874753, 30.106253934668004], [59.86323436597688, 30.10528733505253], [59.86321278304038, 30.10391404403691], [59.86347177735073, 30.102412006988576], [59.86405450715072, 30.10151078475953], [59.8642055835748, 30.10048081649785], [59.86375235223686, 30.099021694793706], [59.86375235223686, 30.097905895843553], [59.86375235223686, 30.096103451385538], [59.86327753180771, 30.094558498992967], [59.863514942881395, 30.09370019210816], [59.86411925428288, 30.093013546600346], [59.86429191265987, 30.09185483230596], [59.86429191265987, 30.08996655715947], [59.8638818475462, 30.08897950424195], [59.863385446147795, 30.087649128570593], [59.86308328513546, 30.08670499099736], [59.86269478835827, 30.08498837722782], [59.862737954891635, 30.082413456573494], [59.86278112136884, 30.08073975814824], [59.86241420452098, 30.079023144378674], [59.86250053826226, 30.076147816314744], [59.86267320507042, 30.074559948577914], [59.862440975242826, 30.074227676598746], [59.85762751737904, 30.0702794649289], [59.85436778360597, 30.067704544274577], [59.85436778360597, 30.066974983422554], [59.85406554040101, 30.066417083947425], [59.853525813540394, 30.06620250722627], [59.853180383730646, 30.06637416860319], [59.85220884313461, 30.06650291463595], [59.85149636193531, 30.06650291463595], [59.84957995388343, 30.066965872144703], [59.83845108465794, 30.069549048423397], [59.82881976122245, 30.071923678555954], [59.81980911511043, 30.074069445767915], [59.81790727537531, 30.074326937833334], [59.817799213029375, 30.07385486904673], [59.81764792515437, 30.072395747342583], [59.81706437975198, 30.071151202359673], [59.81684824922316, 30.070378726163387], [59.816243076259624, 30.070550387540383], [59.81561627835089, 30.07175201717901], [59.81477332458119, 30.072352831998348], [59.81436264704576, 30.074799006619962], [59.814254573184094, 30.076172297635583], [59.814405876517064, 30.07720226589734], [59.81475171011864, 30.078189318814832], [59.81531368204117, 30.079305117765035], [59.81516238284357, 30.084884112516], [59.81440587652601, 30.099904482999353], [59.81397357946035, 30.0993465835243], [59.81323866153597, 30.099389498868536], [59.8127847335183, 30.100333636441743], [59.812698270335396, 30.101320689359213], [59.812849580757735, 30.102264826932494], [59.81332512331227, 30.103852694669325], [59.81395196445936, 30.10556930843884], [59.81399519444729, 30.106856768765965], [59.81343320021606, 30.11046165768202], [59.81302250611075, 30.11316532436898], [59.81250372735099, 30.115740245023325], [59.811984940489005, 30.117585604825578], [59.81127159532403, 30.119774287381723], [59.809715152709195, 30.124022906461352], [59.8062993702436, 30.13355011288221], [59.80288323657792, 30.143334811368568], [59.80106692124648, 30.147969668546352], [59.800288469999636, 30.150115435758234], [59.79886126202077, 30.15183204952775], [59.79786650506309, 30.152347033658664], [59.79739074121067, 30.15372032467429], [59.79743399275139, 30.15612358395164], [59.797304237960354, 30.15895599667136], [59.7978232540852, 30.161273425260188], [59.7982125108601, 30.162732546964286], [59.798818012337385, 30.165650790372474], [59.79933700482374, 30.166938250699676], [59.8001154783574, 30.169341509976977], [59.800807439532534, 30.171315615812016], [59.801658190186586, 30.173208299589874], [59.80282581210157, 30.175354066801834], [59.80420960716096, 30.176899019194376], [59.80576630772179, 30.178443971586997], [59.80689054610352, 30.179473939848677], [59.80775531897332, 30.18119055361824], [59.80862006933462, 30.182907167387782], [59.809311853417746, 30.184967103911216], [59.81017656326463, 30.18960196108895], [59.81110610129207, 30.193764749480106], [59.81173298431536, 30.197498384428794], [59.81261924702469, 30.201189104033297], [59.81370002320566, 30.204321924162723], [59.81469430623404, 30.207111421538205], [59.81603437974513, 30.210072580290607], [59.817590526293294, 30.21286207766614], [59.81839018435161, 30.214192453337528], [59.81957882967413, 30.216252389860962], [59.82065937940359, 30.218183580351685], [59.82158862404956, 30.220458093596303], [59.82262588968304, 30.222904268217892], [59.82351186175252, 30.22526461215101], [59.82424655236718, 30.22762495608407], [59.824873187397685, 30.229770723295978], [59.82554302556763, 30.232560220671512], [59.82649374039898, 30.236551347685673], [59.82815742584404, 30.24367529482923], [59.82928090652177, 30.24831015200696], [59.83111728343342, 30.25642115206799], [59.832003028917576, 30.259983125639756], [59.833299199216746, 30.26551920504651], [59.833299199216746, 30.266248765898556], [59.83340721112348, 30.266892496062134], [59.83342881346263, 30.26749331088142], [59.83340721112348, 30.268609109831623], [59.833299199216746, 30.26951033206067], [59.8329967640078, 30.270583215666633], [59.83271592884615, 30.27148443789563], [59.832478297238005, 30.27272898287854], [59.83241348832233, 30.273973527861454], [59.832370282308226, 30.275046411467372], [59.831916615764534, 30.277278009367752], [59.831419735768485, 30.281912866545536], [59.83120369867653, 30.28397280306902], [59.830818672531606, 30.28519149267417], [59.830170545273944, 30.286221460935927], [59.82913351533858, 30.287251429197603], [59.827707546277, 30.288796381590224], [59.826584012358616, 30.290298418638557], [59.82472577667077, 30.293731646177616], [59.82379661981889, 30.295448259947154], [59.82221915445641, 30.29879565679774], [59.82005812135821, 30.303301767942763], [59.81876143398549, 30.30557628118738], [59.81752953408267, 30.30827994787439], [59.815714019362254, 30.31162734472502], [59.8148494536564, 30.312571482298306], [59.813876790336316, 30.313000635740647], [59.813314794101764, 30.314030604002376], [59.81307702360156, 30.315146402952603], [59.81288248283544, 30.315833048460416], [59.81165036485768, 30.31729217016451], [59.81085054452437, 30.318407969114716], [59.81037496654275, 30.319523768064865], [59.809877764100456, 30.321197466490197], [59.80927246412664, 30.322613672850057], [59.80912113740995, 30.323772387144494], [59.8090346646909, 30.326733545896925], [59.80918599180152, 30.327720598814416], [59.809315700204834, 30.32857890569915], [59.809531879751574, 30.329608873960904], [59.80963996899745, 30.331153826353475], [59.80966158680443, 30.332913355467202], [59.80976967562828, 30.33518786871187], [59.810072322473054, 30.33759112798922], [59.81037496655171, 30.339307741758763], [59.81063437356752, 30.341496424314933], [59.81089377855768, 30.3425693079209], [59.811239648726904, 30.34342761480563], [59.81160713183594, 30.344200091001916], [59.81219077312407, 30.345873789427245], [59.81286086715132, 30.34780497991797], [59.81335802494578, 30.349392847654777], [59.81379033002295, 30.351023630735845], [59.81420101463474, 30.352997736570806], [59.81430908868863, 30.353684382078615], [59.814546850378335, 30.355143503782713], [59.81471976689527, 30.35690303289649], [59.81491429690083, 30.35913463079687], [59.81487106810919, 30.360979990599095], [59.81469815237989, 30.36334033453224], [59.814136170042616, 30.365056948301728], [59.8133580249548, 30.36643023931735], [59.81342287107505, 30.367760614988736], [59.81387679038117, 30.371451334593214], [59.814157784932696, 30.37338252508399], [59.81394163548868, 30.374884562132294], [59.813163485843425, 30.376729921934572], [59.8131202547731, 30.378146128294407], [59.8132283323435, 30.38140769445654], [59.81331479414665, 30.382652239439455], [59.81389840543107, 30.383210138914556], [59.81502236864281, 30.382995562193322], [59.815757247101665, 30.3816222711777], [59.815994998424934, 30.383338884947268], [59.81683792118899, 30.390806154844693], [59.81739985781326, 30.396428064939894], [59.8178537227609, 30.401105837461916], [59.818869493272224, 30.407242731688033], [59.81979878800605, 30.411620096800345], [59.82090094107101, 30.416727022764654], [59.8222623737648, 30.422263102171435], [59.823148355534016, 30.426425890562538], [59.82351570690422, 30.428485827086025], [59.82371018539121, 30.429987864134358], [59.82368857672668, 30.432605700132893], [59.82438004701611, 30.434408144590854], [59.82554687047509, 30.436983065245204], [59.82649758519636, 30.43865676367046], [59.827275422445545, 30.439386324522506], [59.82759951592955, 30.44015880071884], [59.82757790979628, 30.442519144651932], [59.8261734809726, 30.443291620848218], [59.823991096759244, 30.444107012388713], [59.82403431368051, 30.44603820287944], [59.824790600695835, 30.44723983251814], [59.82688650610804, 30.44595237219099], [59.829414380919495, 30.444321589109897], [59.830689048200234, 30.44384952032332], [59.83127235419891, 30.444750742552287], [59.83233092036872, 30.44595237219099], [59.83388630328783, 30.447583155272056], [59.83520400122488, 30.449471430418544], [59.83734244882619, 30.45226092779408], [59.83835762318235, 30.453462557432704], [59.83932956952731, 30.45419211828475], [59.84019349793392, 30.4550933405138], [59.84144615416904, 30.455951647398557], [59.84265557048773, 30.456895784971813], [59.84343302911792, 30.45745368444686], [59.84449120744406, 30.45801158392199], [59.84552775756884, 30.458955721495247], [59.84619717897239, 30.459556536314583], [59.84693136755951, 30.460414843199292], [59.847557574396, 30.461358980772573], [59.84824854753092, 30.46247477972275], [59.84868039843097, 30.463547663328743], [59.849284980245244, 30.465607599852177], [59.85127138577004, 30.472559885618814], [59.85263157309513, 30.477967218992806], [59.85263157309513, 30.479383425352665], [59.8512497950453, 30.47972674810661], [59.84969522592366, 30.480070070860478], [59.84902587511175, 30.4814433618761], [59.84950089966014, 30.482859568236012], [59.85001910049949, 30.482773737547486], [59.85120661355359, 30.482301668760908], [59.851919100977454, 30.48204417669544], [59.85295541899792, 30.48182959997428], [59.85308495647358, 30.482087092039674], [59.85334402991591, 30.486078219053834], [59.853538333671686, 30.493159250853157], [59.853754225388556, 30.499424891111982], [59.85390534875407, 30.50191398107781], [59.85427235978359, 30.50431724035511], [59.85334402993382, 30.505304293272577], [59.85135774855549, 30.508007959959638], [59.85122820433339, 30.508995012877104], [59.85129297650767, 30.510110811827282], [59.85207023273261, 30.511183695433274], [59.85340879797594, 30.512084917662268], [59.85457460110363, 30.51264281713737], [59.854812074494, 30.51264281713737], [59.85537336847476, 30.512428240416188], [59.855977828290534, 30.512213663694954], [59.856387991176106, 30.51135535681022], [59.856647038805605, 30.51156993353138], [59.85712195420344, 30.51238532507195], [59.85809335087678, 30.514316515562623], [59.85863300341646, 30.51560397588985], [59.86126638170781, 30.52101130926387], [59.863640559872465, 30.525560335753102], [59.86476283945413, 30.52770610296501], [59.865841918604936, 30.52925105535763], [59.86709360641136, 30.53062434637325], [59.86812945022974, 30.531568483946483], [59.86929473583004, 30.532255129454295], [59.87089154215679, 30.532684282896685], [59.87283350020714, 30.53277011358516], [59.87421437891896, 30.532169298765872], [59.87550890044948, 30.53148265325806], [59.87684651956623, 30.530710177061724], [59.87887441974294, 30.529766039488496], [59.88055705119031, 30.528736071226817], [59.882886707490954, 30.527620272276614], [59.88510835674288, 30.526289896605356], [59.887135751212014, 30.525474505064857], [59.888192535291566, 30.52530284368791], [59.88896892660498, 30.525646166441778], [59.889659036928315, 30.526075319884196], [59.89080200051629, 30.52684779608048], [59.891707717228286, 30.52727694952287], [59.89306624584634, 30.5271052881459], [59.89455409418838, 30.52676196539201], [59.895912506031614, 30.52633281194967], [59.89688276607518, 30.52573199713028], [59.89789611842769, 30.525903658507275], [59.89972869816185, 30.52654738867085], [59.9018629866677, 30.526933626769004], [59.903954024760644, 30.52714820349014], [59.905764713908916, 30.5271052881459], [59.9086314357789, 30.526804880736243], [59.9127694233219, 30.52641864263814], [59.91582947705544, 30.52633281194967], [59.917143920265765, 30.52650447332656], [59.918350576245395, 30.52684779608048], [59.9202251151875, 30.527448610899846], [59.92143165876713, 30.52787776434221], [59.92304749639848, 30.52937980139057], [59.924124677626914, 30.53015227758688], [59.92582655245485, 30.532040552733317], [59.92744217536757, 30.534186319945224], [59.92931619904999, 30.535817103026318], [59.93112550043176, 30.53719039404194], [59.93358082251651, 30.538520769713376], [59.935562177541065, 30.539035753844242], [59.93952453131226, 30.53972239935205], [59.94230220260815, 30.540108637450157], [59.94327110279476, 30.541825251219723], [59.94396008119273, 30.542983965514164], [59.94611304610569, 30.54461474859518], [59.94688807912947, 30.544657663939418], [59.94772767772274, 30.54401393377584], [59.94865336426115, 30.54362769567774], [59.94968665814202, 30.544271425841263], [59.95362579454761, 30.548562960265127], [59.95633771378731, 30.551352457640583], [59.95799488814576, 30.55281157934468], [59.95982413990258, 30.553927378294908], [59.961545696063276, 30.55461402380272], [59.96268617758652, 30.55478568517969], [59.964923989107376, 30.554399447081487], [59.96714013372797, 30.553498224852543], [59.968538595027844, 30.552382425902287], [59.97004456402086, 30.550751642821247], [59.97079752276193, 30.549721674559567], [59.971959196827136, 30.54779048406884], [59.97299176167317, 30.54585929357812], [59.97387371856535, 30.54362769567774], [59.97454054837372, 30.541825251219723], [59.97505679446499, 30.539979891417474], [59.97602473410327, 30.536847071288047], [59.97701415417714, 30.53367133581446], [59.978154101385144, 30.529851870177247], [59.97942305290146, 30.525903658507325], [59.98026182457161, 30.52315707647603], [59.98073496841505, 30.52101130926412], [59.98122961155131, 30.518565134642532], [59.981788764417814, 30.51500316107079], [59.98219737013519, 30.511484102843262], [59.98239091844562, 30.50985331976217], [59.98256296043498, 30.50740714514058], [59.98264898109327, 30.50590510809227], [59.9831220907046, 30.50251479589745], [59.983552184463896, 30.500497774718255], [59.984111297977485, 30.497536615965853], [59.98477792092566, 30.495476679442415], [59.98613262928335, 30.49217219793607], [59.98705723955141, 30.4900693460684], [59.98757328982715, 30.489125208495143], [59.988153836737, 30.488223986266096], [59.98884187910267, 30.48818107092191], [59.98952990710696, 30.48843856298733], [59.99013191986334, 30.488052324889228], [59.99077692131798, 30.487365679381416], [59.991013418690855, 30.486378626463896], [59.99094891957552, 30.48517699682527], [59.99077692131798, 30.483846621153887], [59.99103491836799, 30.48337455236723], [59.99161540435134, 30.482301668761316], [59.99339979728435, 30.48071380102446], [59.9953345720835, 30.47908301794344], [59.997398206760415, 30.477795557616318], [59.99933274696831, 30.477194742796954], [60.00111672233163, 30.476980166075798], [60.002556728417005, 30.47693725073156], [60.003932197888545, 30.477108912108505], [60.005930824659735, 30.476980166075798], [60.00739210947302, 30.476722674010325], [60.00900374553211, 30.475950197814043], [60.01055084201606, 30.47483439886389], [60.01186151969895, 30.473632769225212], [60.01295729217717, 30.472173647521117], [60.0137522415605, 30.47088618719397], [60.01454717176579, 30.469555811522582], [60.01517021176367, 30.468482927916614], [60.01613697465242, 30.46599383795084], [60.016674052883985, 30.46462054693522], [60.01701777835756, 30.46457763159098], [60.01761928930755, 30.46462054693522], [60.0182852350583, 30.464363054869747], [60.018650425395094, 30.46298976385415], [60.019037093104174, 30.461959795592445], [60.01925190653706, 30.460586504576824], [60.019101537281095, 30.459556536315095], [60.019037093104174, 30.45874114477452], [60.01938079392442, 30.45762534582437], [60.02008966554146, 30.456595377562614], [60.021228124398505, 30.455050425170043], [60.02335457423673, 30.452775911925453], [60.0277144410582, 30.448613123534297], [60.030677961882006, 30.445651964781895], [60.033018525322454, 30.44329162084875], [60.03368415977573, 30.443077044127644], [60.03415653734656, 30.4433774515373], [60.03477920651663, 30.444021181700876], [60.03538039316183, 30.444321589110558], [60.037441521174365, 30.444364504454796], [60.038600848973026, 30.444321589110558], [60.03907315600041, 30.444922403929844], [60.03945958398225, 30.44513698065108], [60.039888943086034, 30.445523218749184], [60.040640308041404, 30.44483657324137], [60.041005250545595, 30.444321589110558], [60.041584856794394, 30.444235758422035], [60.04207858740034, 30.44397826635664], [60.04233618303729, 30.443077044127644], [60.04229325057112, 30.4421758218986], [60.04201418817613, 30.440802530883], [60.041563390078316, 30.439815477965535], [60.04098378345145, 30.438785509703806], [60.04167072352779, 30.437970118163285], [60.0427655046276, 30.436811403868894], [60.043817318834215, 30.434966044066645], [60.04480470566232, 30.43320651495284], [60.04559888662328, 30.431404070494853], [60.046028165644536, 30.43183322393722], [60.04617841197902, 30.432820276854684], [60.046779390457225, 30.433506922362547], [60.047165727968924, 30.433893160460652], [60.04759498655114, 30.43251986944503], [60.04761644933329, 30.431361155150615], [60.048088626998194, 30.42977328741381], [60.049097347492264, 30.4265117212517], [60.04982704090501, 30.423893885253086], [60.049719734072795, 30.422949747679933], [60.049376349829075, 30.422306017516306], [60.04851787354131, 30.422005610106652], [60.0489685763851, 30.420160250304423], [60.04976265686027, 30.416555361388422], [60.05111469572141, 30.411062197325954], [60.052337921103366, 30.405826525328884], [60.053196297724696, 30.40256495916675], [60.053775689283356, 30.40106292211844], [60.05439798737848, 30.399603800414344], [60.05547088746912, 30.397887186644805], [60.056586666443955, 30.39724345648123], [60.05757367014289, 30.39655681097342], [60.058431910155555, 30.39514060461356], [60.05901120950477, 30.392951922057414], [60.05911848604236, 30.39084907018972], [60.05969777330832, 30.390119509337723], [60.06087777134589, 30.38887496435481], [60.06201482030966, 30.38788791143729], [60.06385975951858, 30.386772112487137], [60.06840730713826, 30.38471217596378], [60.07158163740953, 30.383253054259633], [60.07518455982567, 30.38187976324401], [60.08015937494446, 30.380506472228387], [60.083032416475206, 30.37990565740905], [60.08560507629825, 30.37827487432803], [60.088177534693386, 30.37578578436218], [60.09057831418401, 30.37153716528263], [60.09104987524427, 30.371751742003813], [60.09165003407592, 30.372137980101993], [60.09212157975118, 30.37149424993842], [60.09285031884356, 30.370378450988188], [60.093450444779876, 30.369348482726508], [60.09387909944974, 30.368490175841753], [60.09392196460905, 30.36763186895697], [60.09368620554062, 30.366387323974056], [60.093407579005195, 30.364756540892962], [60.0933647131746, 30.363168673156157], [60.09357904176821, 30.361795382140535], [60.093771936297706, 30.360336260436515], [60.094093424695856, 30.35758967840522], [60.09430774852539, 30.355915979979965], [60.09447920659824, 30.353813128112293], [60.09465066376705, 30.352010683654278], [60.09480068805553, 30.349392847655718], [60.094907847841995, 30.346732096312945], [60.09499357541943, 30.34381385290478], [60.095036439124215, 30.34123893225048], [60.09512216636605, 30.338234858153765], [60.09518646165956, 30.335874514220723], [60.09522932511264, 30.333213762877953], [60.09535791513624, 30.329866366027368], [60.095379346757916, 30.32772059881546], [60.09548650464733, 30.325660662292027], [60.0956579565667, 30.321240381835477], [60.095893701481906, 30.317978815673367], [60.096322324274226, 30.3136872812495], [60.09660092608354, 30.311026529906727], [60.09690095615818, 30.30858035528519], [60.097415287051874, 30.305232958434555], [60.097822459963375, 30.302486376403337], [60.09820819806477, 30.299868540404773], [60.09872250847613, 30.296735720275425], [60.099065377623816, 30.294504122374992], [60.09923681085067, 30.29188628637648], [60.09945110112565, 30.289440111754868], [60.09957967462836, 30.286221460937046], [60.099622532347766, 30.283217386840406], [60.09957967462836, 30.280213312743715], [60.099451101134626, 30.27806754553181], [60.099429672170054, 30.276222185729555], [60.09960110349508, 30.274677233336988], [60.09996539208913, 30.272273974059583], [60.10011539210024, 30.270557360290095], [60.10030824825055, 30.26854033911087], [60.10071538530171, 30.26566501104694], [60.10099394984304, 30.2638625665889], [60.101165373010495, 30.26158805334431], [60.10090823793718, 30.258970217345773], [60.1008439538542, 30.25746818029739], [60.100458246713586, 30.253734545348703], [60.10028681986341, 30.250987963317456], [60.10011539211827, 30.249743418334543], [60.09977253394314, 30.24875636541705], [60.09915109437612, 30.248155550597712], [60.09844392470102, 30.24837012731892], [60.0977581698663, 30.24875636541705], [60.09711526170323, 30.250987963317456], [60.096879525556496, 30.252876238463944], [60.09606515130256, 30.254292444823804], [60.09570081944944, 30.25433536016804], [60.09475782409712, 30.251674608825294], [60.09424345158375, 30.250129656432673], [60.093921964672134, 30.24862761938439], [60.09366477287719, 30.2476405664669], [60.09310751707917, 30.2461814447628], [60.092593118720195, 30.245022730468364], [60.09212157983236, 30.245151476501047], [60.09169290222549, 30.24399276220666], [60.09057831426519, 30.24141784155236], [60.0898495247749, 30.239615397094344], [60.08918502613964, 30.23794169866904], [60.08852051406291, 30.23613925421105], [60.08749156561782, 30.23292060339318], [60.086591209292074, 30.229659037231066], [60.0856479523997, 30.225367502807277], [60.08517631379377, 30.223007158874136], [60.08457603668534, 30.218458132384903], [60.08421157737613, 30.214767412780425], [60.08401862670241, 30.21167750799526], [60.083739918160354, 30.207815127013863], [60.083396889017116, 30.20446773016328], [60.08251786050073, 30.19867415869111], [60.081831773117415, 30.195412592528996], [60.081338638962556, 30.19365306341522], [60.08028802412934, 30.19056315863008], [60.07867987515823, 30.186443285583188], [60.07829390769339, 30.184898333190617], [60.07812236514294, 30.18301005804413], [60.0779079356958, 30.181078867553406], [60.077328969200245, 30.17970557653778], [60.07664277348002, 30.1789331003415], [60.07597800771417, 30.17923350775113], [60.07507733587378, 30.179963068603175], [60.07404796639783, 30.178632692931817], [60.07265397721256, 30.177130655883534], [60.071817555315306, 30.17601485693333], [60.070337679824, 30.173954920409898], [60.06950119899142, 30.172882036803905], [60.06851455321768, 30.171422915099836], [60.06716322944805, 30.169320063232163], [60.06591910448565, 30.16704554998752], [60.06478219051256, 30.16468520605438], [60.06375249865305, 30.162281946777078], [60.06313037752992, 30.160651163696038], [60.06242243228031, 30.15854831182834], [60.06160720372902, 30.15571589910867], [60.061092312120806, 30.153355555175555], [60.06109231211172, 30.150523142455786], [60.06145702783362, 30.146446184753156], [60.06102795009394, 30.143184618591043], [60.06038432299699, 30.141425089477266], [60.05758141580676, 30.12720942162628], [60.05631204335747, 30.119471258600296], [60.05628715840986, 30.116196291375097]]],
				detour: ['В пределах КАД', 'За КАД:']
			}
		};
		var domain = location.hostname.split('.')[0] == 'www' ? location.hostname.split('.')[1] : location.hostname.split('.')[0];
		var city = cities[domain] || cities.msk;

		// Подсказки адресов для инпутов форм
		function initFormSuggest(input) {
			$(input).suggestions({
				token: '2267571a9b74e90c77a347a17eca6186b05a0a90',
				type: 'ADDRESS',
				onSelect: function onSelect(suggestion) {
					input.value = suggestion.value;
				}
			});
			$(input).attr('autocomplete', 'off');

			// Обработка события blur для выбора первого предложения, если ничего не выбрано
			$(input).on('blur', function () {
				console.log('Событие blur сработало'); // Проверка, заходит ли внутрь blur
				const suggestionsInstance = $(input).suggestions();
				
				if (suggestionsInstance && suggestionsInstance.suggestions) {
					const suggestions = suggestionsInstance.suggestions;
					
					if (suggestions.length > 0) {
						console.log("Автоподстановка города: " + suggestions[0].value);
						input.value = suggestions[0].value;
					}
				} else {
					console.error('Экземпляр suggestions или свойство suggestions не определены.');
				}
			});
		};
		$('.address-form .input--address input').each(function () {
			initFormSuggest(this);
		});
		$('.calc-form .input--address input').each(function () {
			initFormSuggest(this);
		});

		// Добавить/удалить поле адреса формы
		$('.address-form').on('click', '.input--address button', function () {
			var $button = $(this);
			var $form = $button.closest('form');
			var $input = $button.siblings('input');
			var $inputParent = $input.parent();
			var $addressInputs = $form.find('.input--address');
			if ($inputParent.is(':last-child:not(:nth-child(5))')) {
				if ($input[0].checkValidity()) {
					if ($addressInputs.length < 5) {
						$inputParent.clone().appendTo($inputParent.parent()).find('.suggestions-wrapper').remove();
						$addressInputs = $form.find('.input--address');
						initFormSuggest($form.find('.input--address:last-child input')[0]);
						$inputParent.next().find('input').val('').trigger('focus');
					}
				} else {
					$input[0].reportValidity();
				}
			} else {
				var $lastInputParent = $form.find('.input--address:last-child');
				var $lastInput = $lastInputParent.find('input');
				if (!$lastInput[0].checkValidity() && $addressInputs.length > 2) {
					$lastInputParent.remove();
				} else {
					$inputParent.remove();
				}
			}
		});

		// Удалить пустое/невалидное поле адреса формы
		$('.address-form').on('blur', '.input--address input', function () {
			var $input = $(this);
			var $form = $input.closest('form');
			var $inputParent = $input.parent();
			var $addressInputs = $form.find('.input--address');
			var $hoveredButtons = $addressInputs.find('button:hover');
			if ($inputParent.find('.suggestions-hint').text() == 'Неизвестный адрес') {
				$input.val('');
			}
			if (!$input[0].checkValidity() && !$hoveredButtons.length && $addressInputs.length > 2) {
				$inputParent.remove();
			}
		});
	}

	// Калькулятор стоимости с картой
	if ($('.calc-form').length) {
		// Дефолтные данные
		var defaultData = {
			addresses: [],
			overZoneFirstLength: 0,
			overZoneLastLength: 0,
			overZoneOtherLength: 0,
			overZoneDistance: 0,
			mkad: 0,
			timeClear: 0,
			timeFull: 0,
			routeLength: 0
		};
		var data = defaultData;
		var suggestArr = [];
	
		// Инициализация карты
		var ymaps = window.ymaps;
		ymaps.ready(function () {
			var thisMap = this;
			var map = null;
			var mark = null;
			var route = null;
			var cityPoly = null;
			var firstPoint = null;
			var lastPoint = null;

			map = new ymaps.Map('calc-map', {
				center: city.center,
				zoom: 9,
				behaviors: ['drag', 'dblClickZoom', 'multiTouch', 'rightMouseButtonMagnifier'],
				controls: []
			});
			cityPoly = new ymaps.Polygon(city.city);
			ymaps.geoQuery(cityPoly).setOptions('visible', false).addToMap(map);
			var iconStart = 'data:image/png;base64,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';
			mark = new ymaps.Placemark(city.center, {}, {
				iconLayout: 'default#image',
				iconImageHref: iconStart,
				iconImageSize: [78, 86],
				iconImageOffset: [-44, -86]
			});
			map.geoObjects.add(mark);
		
			// Кнопки управления зумом карты
			var $mapHeight = $('.calc-map__container').height();
			var $zoomOffset = sizeMD.matches ? 103 : 30;
			var $zoomPosition = ($mapHeight / 2) - $zoomOffset;
			map.controls.add('zoomControl', {
				position: {
					top: $zoomPosition,
					right: sizeMD.matches ? 320 : 15
				}
			});
			$(breakpoints).each(function () {
				$(this).on('change', function () {
					if ($('.calc-map__container').height() != $mapHeight) {
						$mapHeight = $('.calc-map__container').height();
						$zoomOffset = sizeMD.matches ? 103 : 30;
						$zoomPosition = ($mapHeight / 2) - $zoomOffset;
						map.controls.remove('zoomControl').add('zoomControl', {
							position: {
								top: $zoomPosition,
								right: sizeMD.matches ? 320 : 15
							}
						});
					}
				});
			});

			// Подсказки адресов для инпутов калькулятора
			function initCalcSuggest(input, index) {
				var suggest = $(input).suggestions({
					token: '2267571a9b74e90c77a347a17eca6186b05a0a90',
					type: 'ADDRESS',
					onSelect: function onSelect(suggestion) {
						input.value = suggestion.value;
						setAddress();
					}
				});
				suggestArr[index] = suggest;
				$(input).attr('autocomplete', 'off');
			};

			$('.calc-input--address input').each(function (key, i) {
				initCalcSuggest(i, key);
			});

			// Поиск адресов
			async function setAddress() {
				// Получите все адреса сразу, используя карту вместо каждого отдельного адреса
				data.addresses = Array.from($('.calc-input--address input')).map(input => {
					const $input = $(input);
					const inputParentIndex = $input.parent().index();
					return {index: inputParentIndex, value: $input.val()};
				}).sort((a,b) => a.index - b.index) // Сортировать по индексу
				.map(item => item.value);

				// Фильтровать непустые адреса
				const addresses = data.addresses.filter(Boolean);
				
				if (!addresses.length) return;

				try {
					// При необходимости обрабатывайте первую и последнюю точки параллельно.
					const updates = [];

					if (addresses[0] !== firstPoint) {
						updates.push(updateEdgeRoute(firstPoint = addresses[0], 'overZoneFirstLength'));
					}

					if (addresses.length > 1 && addresses[addresses.length - 1] !== lastPoint) {
						updates.push(updateEdgeRoute(lastPoint = addresses[addresses.length - 1], 'overZoneLastLength')); 
					}

					// Дождитесь завершения всех обновлений Edge.
					if (updates.length) await Promise.all(updates);

					// Найдите маршрут
					await searchRoute();

				} catch (error) {
					console.error('Ошибка при поиски адреса:', error);
				}
			}

			// Добавление точек и построение маршрута
			async function searchRoute() {
				try {
					// Очистка предыдущих объектов с карты
					if (mark) {
						map.geoObjects.remove(mark);
						mark = null;
					}
					if (route) {
						map.geoObjects.remove(route);
						route = null; 
					}

					// Сброс данных маршрута
					Object.assign(data, {
						overZoneOtherLength: 0,
						timeClear: 0,
						timeFull: 0,
						routeLength: 0
					});

					// Фильтрация пустых адресов
					const addresses = data.addresses.filter(Boolean);
					
					if (addresses.length < 1) return;

					if (addresses.length === 1) {
						// Для одной точки - создаем метку
						const point = await ymaps.geocode(addresses[0], {
							boundedBy: city.bounds
						});

						mark = new ymaps.Placemark(
							point.geoObjects.get(0).geometry.getCoordinates(),
							{},
							{
								iconLayout: 'default#image',
								iconImageHref: iconStart,
								iconImageSize: [78, 86],
								iconImageOffset: [-44, -86]
							}
						);
						
						map.geoObjects.add(mark);
					} else {
						// Для нескольких точек строим маршрут
						await calcRoute();
					}
				} catch (error) {
					console.error('Ошибка при построении маршрута:', error);
				}
			}

			async function calcRoute() {
				try {
					// Фильтрация адресов
					const addresses = data.addresses.filter(Boolean);

					if (addresses.length < 1) return;

					// Создаем multiRoute для оптимизированного построения маршрута
					const multiRoute = new ymaps.multiRouter.MultiRoute({
						referencePoints: addresses,
						params: {
							results: 1,
							routingMode: 'auto'
						}
					}, {
						boundsAutoApply: true
					});

					// Ждем загрузки маршрута с таймаутом
					await new Promise((resolve, reject) => {
						const timeout = setTimeout(() => {
							reject(new Error('Таймаут при построении маршрута'));
						}, 10000);

						multiRoute.model.events.add('requestsuccess', () => {
							clearTimeout(timeout);
							resolve();
						});
						multiRoute.model.events.add('requesterror', (error) => {
							clearTimeout(timeout);
							reject(error);
						});
					});

					// Получаем активный маршрут
					const activeRoute = multiRoute.getActiveRoute();
					if (!activeRoute) {
						throw new Error('Не удалось получить активный маршрут');
					}

					// Проверяем геометрию маршрута
					const geometry = activeRoute.geometry;
					if (!geometry) {
						throw new Error('Не удалось получить геометрию маршрута');
					}

					// Получаем время и длину маршрута с проверкой
					const durationInTraffic = activeRoute.properties.get('durationInTraffic');
					const duration = activeRoute.properties.get('duration');
					const distance = activeRoute.properties.get('distance');

					if (!durationInTraffic || !duration || !distance) {
						throw new Error('Не удалось получить параметры маршрута');
					}

					data.timeFull = durationInTraffic.text;
					data.timeClear = duration.text;
					data.routeLength = distance.value;

					// Оптимизированный расчет расстояния вне города
					const coordinates = geometry.getCoordinates();
					if (!coordinates || !coordinates.length) {
						throw new Error('Не удалось получить координаты маршрута');
					}

					const chunks = [];
					const chunkSize = 100;

					for (let i = 0; i < coordinates.length; i += chunkSize) {
						chunks.push(coordinates.slice(i, i + chunkSize));
					}

					let dist = 0;
					const simplifiedCityPoly = cityPoly.geometry.getCoordinates()[0].filter((_, i) => i % 3 === 0);

					for (const chunk of chunks) {
						for (const coord of chunk) {
							if (!ymaps.util.bounds.containsPoint(
								ymaps.util.bounds.fromPoints(simplifiedCityPoly),
								coord
							)) {
								dist += ymaps.coordSystem.geo.getDistance(
									coord,
									chunk[chunk.indexOf(coord) + 1] || coord
								);
							}
						}
					}

					data.overZoneOtherLength = dist;

					// Вычисление зональных расстояний
					const overZoneDistance = data.overZoneOtherLength + data.overZoneFirstLength + data.overZoneLastLength;
					data.overZoneDistance = overZoneDistance > 100 ? Math.ceil(overZoneDistance / 1000) : 0;
					
					const km = data.routeLength > 100 ? Math.ceil(data.routeLength / 1000) : 0;
					data.mkad = data.overZoneOtherLength + data.overZoneFirstLength > 100 ? 
						Math.ceil((data.overZoneOtherLength + data.overZoneFirstLength) / 1000) : 0;

					// Обновление UI
					$('.calc-route__full').html(data.timeFull);
					$('.calc-route__clear').html(data.timeClear);
					$('.calc-route__zone').html('Расстояние: ' + km + 'км').attr('data-dist', km);
					$('.calc-route').fadeIn(300);

					// Расчет цен для автомобилей
					await calculatePrices(km);

					// Отрисовка маршрута на карте
					await drawRoute(addresses);
					
				} catch (error) {
					console.error('Ошибка при расчете маршрута:', error);
					// Скрываем блок с результатами при ошибке
					$('.calc-route').hide();
					// Показываем сообщение об ошибке пользователю
					$('.calc-route__error').html('Не удалось построить маршрут. Пожалуйста, проверьте адреса и попробуйте снова.').show();
				}
			}


			// Вынесенный расчет цен
			async function calculatePrices(distance) {
				const cars = $('.calc-step__cars-inner .calc-car');
				const dopPoints = $('.calc-step__inputs .input--address-to').length;

				cars.each((_, carEl) => {
					const $car = $(carEl);
					const $input = $car.find('input');
					
					const basePrice = Number($input.attr('data-base-price'));
					const baseDistance = Number($input.attr('data-base-distance')); 
					const extraKmPrice = Number($input.attr('data-extra-km-price'));
					const extraPointPrice = Number($input.attr('data-extra-point-price'));

					let price = basePrice;

					if (dopPoints > 1) {
						price += (dopPoints - 1) * extraPointPrice;
					}

					if (distance > baseDistance) {
						price += (distance - baseDistance) * extraKmPrice;
					}

					const displayPrice = Math.ceil(price).toLocaleString('ru-RU');
					$car.find('.calc-car__price').html('От ' + displayPrice + '\xa0₽');

					if ($car.hasClass('is-active')) {
						$('.calc-route_price__clear, .calc-cost__value')
							.html(displayPrice + '\xa0₽');
					}
				});
			}

			// Вынесенная отрисовка маршрута
			async function drawRoute(addresses) {
				const routeConfig = {
					mapStateAutoApply: true
				};

				const _route = await ymaps.route(addresses, routeConfig);

				const strokeWidth = sizeSM.matches ? 5 : 3;
				_route.getPaths().options.set({
					strokeColor: '#29B0E0',
					strokeWidth,
					opacity: 1
				});

				route = _route;
				map.geoObjects.add(route);

				const points = route.getWayPoints();
				const iconImageSize = sizeSM.matches ? [56, 56] : [46, 46];
				const iconImageOffset = sizeSM.matches ? [-28, -28] : [-23, -23];
				const mobileClass = !sizeSM.matches ? ' calc-map__point--mobile' : '';

				points.options.set({
					iconLayout: 'default#imageWithContent',
					iconImageHref: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA1NiA1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxjaXJjbGUgY3g9IjI4IiBjeT0iMjgiIHI9IjI4IiBmaWxsPSIjMjliMGUwIi8+Cgk8Y2lyY2xlIGN4PSIyOCIgY3k9IjI4IiByPSIxNiIgZmlsbD0iI2ZmZiIvPgo8L3N2Zz4K',
					iconImageSize,
					iconImageOffset,
					iconContentOffset: [0, 0],
					iconContentLayout: ymaps.templateLayoutFactory.createClass(
						'<div class="calc-map__point' + mobileClass + '">$[properties.iconContent]</div>'
					)
				});

				points.get(0).options.set({
					iconLayout: 'default#image',
					iconImageHref: iconStart,
					iconImageSize: [78, 86],
					iconImageOffset: [-44, -86]
				});
			}

			// Обновление маршрута
			function updateEdgeRoute(value, param, callback) {
				// Кэш для хранения результатов геокодирования
				const geocodeCache = new Map();
				
				// Упрощенный полигон города для быстрых проверок
				const simplifiedCityPoly = cityPoly.geometry.getCoordinates()[0].filter((_, i) => i % 3 === 0);
				
				// Асинхронная функция для основных вычислений
				async function calculateRoute() {
					try {
						// Проверяем кэш геокодирования
						let point;
						if (geocodeCache.has(value)) {
							point = geocodeCache.get(value);
						} else {
							const result = await ymaps.geocode(value, {
								boundedBy: city.bounds
							});
							point = result.geoObjects.get(0).geometry.getCoordinates();
							geocodeCache.set(value, point);
						}

						// Проверка принадлежности точки городу
						const isInCity = ymaps.util.bounds.containsPoint(
							ymaps.util.bounds.fromPoints(simplifiedCityPoly),
							point
						);

						if (!isInCity) {
							// Используем multiRoute для оптимизированного построения маршрута
							const multiRoute = new ymaps.multiRouter.MultiRoute({
								referencePoints: [city.center, point],
								params: {
									results: 1,
									routingMode: 'auto'
								}
							});

							// Ждем загрузки маршрута
							await new Promise((resolve, reject) => {
								multiRoute.model.events.add('requestsuccess', () => resolve());
								multiRoute.model.events.add('requesterror', () => reject());
							});

							// Получаем активный маршрут
							const activeRoute = multiRoute.getActiveRoute();
							const routeLength = activeRoute.properties.get("distance").value;
							
							// Вычисляем часть маршрута внутри города
							const cityDistance = await new Promise(resolve => {
								const segments = activeRoute.getPaths().get(0).getSegments();
								let inCityDist = 0;
								
								// Используем цикл for вместо forEach
								for (let i = 0; i < segments.length; i++) {
									const segment = segments.get(i);
									const coords = segment.geometry.getCoordinates();
									if (ymaps.util.bounds.containsPoint(
										ymaps.util.bounds.fromPoints(simplifiedCityPoly),
										coords[0]
									)) {
										inCityDist += segment.properties.get('distance').value;
									}
								}
								
								resolve(inCityDist);
							});

							data[param] = routeLength - cityDistance;
						} else {
							data[param] = 0;
						}

						if (callback) callback();
						
					} catch (error) {
						console.error('Ошибка при расчете маршрута:', error);
						data[param] = 0;
						if (callback) callback();
					}
				}

				// Запускаем асинхронные вычисления
				calculateRoute();
			};

		});
	}

	// // Калькулятор стоимости с картой
	// if ($('.calc-form').length) {
	// 	// Дефолтные данные
	// 	var defaultData = {
	// 		addresses: [],
	// 		overZoneFirstLength: 0,
	// 		overZoneLastLength: 0,
	// 		overZoneOtherLength: 0,
	// 		overZoneDistance: 0,
	// 		mkad: 0,
	// 		timeClear: 0,
	// 		timeFull: 0,
	// 		routeLength: 0
	// 	};
	// 	var data = defaultData;
	// 	var suggestArr = [];

	// 	// Инициализация карты
	// 	var ymaps = window.ymaps;
	// 	ymaps.ready(function () {
	// 		var thisMap = this;
	// 		var map = null;
	// 		var mark = null;
	// 		var route = null;
	// 		var cityPoly = null;
	// 		var firstPoint = null;
	// 		var lastPoint = null;

	// 		map = new ymaps.Map('calc-map', {
	// 			center: city.center,
	// 			zoom: 9,
	// 			behaviors: ['drag', 'dblClickZoom', 'multiTouch', 'rightMouseButtonMagnifier'],
	// 			controls: []
	// 		});
	// 		cityPoly = new ymaps.Polygon(city.city);
	// 		ymaps.geoQuery(cityPoly).setOptions('visible', false).addToMap(map);
	// 		var iconStart = 'data:image/png;base64,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';
	// 		mark = new ymaps.Placemark(city.center, {}, {
	// 			iconLayout: 'default#image',
	// 			iconImageHref: iconStart,
	// 			iconImageSize: [78, 86],
	// 			iconImageOffset: [-44, -86]
	// 		});
	// 		map.geoObjects.add(mark);

	// 		// Кнопки управления зумом карты
	// 		var $mapHeight = $('.calc-map__container').height();
	// 		var $zoomOffset = sizeMD.matches ? 103 : 30;
	// 		var $zoomPosition = ($mapHeight / 2) - $zoomOffset;
	// 		map.controls.add('zoomControl', {
	// 			position: {
	// 				top: $zoomPosition,
	// 				right: sizeMD.matches ? 320 : 15
	// 			}
	// 		});
	// 		$(breakpoints).each(function () {
	// 			$(this).on('change', function () {
	// 				if ($('.calc-map__container').height() != $mapHeight) {
	// 					$mapHeight = $('.calc-map__container').height();
	// 					$zoomOffset = sizeMD.matches ? 103 : 30;
	// 					$zoomPosition = ($mapHeight / 2) - $zoomOffset;
	// 					map.controls.remove('zoomControl').add('zoomControl', {
	// 						position: {
	// 							top: $zoomPosition,
	// 							right: sizeMD.matches ? 320 : 15
	// 						}
	// 					});
	// 				}
	// 			});
	// 		});

	// 		// Подсказки адресов для инпутов калькулятора
	// 		function initCalcSuggest(input, index) {
	// 			var suggest = $(input).suggestions({
	// 				token: '2267571a9b74e90c77a347a17eca6186b05a0a90',
	// 				type: 'ADDRESS',
	// 				onSelect: function onSelect(suggestion) {
	// 					input.value = suggestion.value;
	// 					setAddress();
	// 				}
	// 			});
	// 			suggestArr[index] = suggest;
	// 			$(input).attr('autocomplete', 'off');
	// 		};

	// 		$('.calc-input--address input').each(function (key, i) {
	// 			initCalcSuggest(i, key);
	// 		});

	// 		// Поиск адресов
	// 		function setAddress() {
	// 			data.addresses = [];
	// 			$('.calc-input--address input').each(function (key, i) {
	// 				var $input = $(this);
	// 				var $inputParent = $input.parent();
	// 				var $inputParentIndex = $inputParent.index();
	// 				data.addresses[$inputParentIndex] = $input.val();
	// 			});
	// 			var addresses = data.addresses.filter(function (i) {
	// 				return i;
	// 			});
	// 			var callbackInit = 0;
	// 			if (addresses[0] !== firstPoint) {
	// 				updateEdgeRoute(firstPoint = addresses[0], 'overZoneFirstLength', searchRoute);
	// 			} else {
	// 				callbackInit++;
	// 			}
	// 			if (addresses[addresses.length - 1] !== lastPoint && addresses.length > 1) {
	// 				updateEdgeRoute(lastPoint = addresses[addresses.length - 1], 'overZoneLastLength', searchRoute);
	// 			} else {
	// 				callbackInit++;
	// 			}
	// 			if (callbackInit == 2) {
	// 				searchRoute();
	// 			}
	// 		};

	// 		// Добавление точек и построение маршрута
	// 		function searchRoute() {
	// 			if (mark) {
	// 				map.geoObjects.remove(mark);
	// 				mark = null;
	// 			}
	// 			if (route) {
	// 				map.geoObjects.remove(route);
	// 				route = null;
	// 			}
	// 			data.overZoneOtherLength = 0;
	// 			data.timeClear = 0;
	// 			data.timeFull = 0;
	// 			data.routeLength = 0;
	// 			var addresses = data.addresses.filter(function (i) {
	// 				return i;
	// 			});
	// 			if (addresses.length < 1) return;
	// 			if (addresses.length === 1) {
	// 				ymaps.geocode(addresses[0], {
	// 					boundedBy: city.bounds
	// 				}).then($.proxy(function (point) {
	// 					mark = new ymaps.Placemark(point.geoObjects.get(0).geometry.getCoordinates(), {}, {
	// 						iconLayout: 'default#image',
	// 						iconImageHref: iconStart,
	// 						iconImageSize: [78, 86],
	// 						iconImageOffset: [-44, -86]
	// 					});
	// 					map.geoObjects.add(mark);
	// 				}, thisMap));
	// 			} else {
	// 				calcRoute();
	// 			}
	// 		};

	// 		// Расчет маршрута
	// 		function calcRoute() {
	// 			var addresses = data.addresses.filter(function (i) {
	// 				return i;
	// 			});
				
	// 			// Use multiRoute instead of route for better performance
	// 			var multiRoute = new ymaps.multiRouter.MultiRoute({
	// 				referencePoints: addresses,
	// 				params: {
	// 					routingMode: 'pedestrian'
	// 				}
	// 			}, {
	// 				boundsAutoApply: true,
	// 				zoomMargin: 50
	// 			});

	// 			multiRoute.model.events.add('requestsuccess', function() {
	// 				var route = multiRoute.getActiveRoute();
					
	// 				if (route.getJamsTime() >= route.getTime()) {
	// 					data.timeFull = route.getHumanJamsTime();
	// 					data.timeClear = route.getHumanTime();
	// 				} else {
	// 					data.timeFull = route.getHumanTime();
	// 					data.timeClear = route.getHumanJamsTime();
	// 				}
					
	// 				data.routeLength = route.getLength();
					
	// 				// Simplified distance calculation
	// 				var path = route.getPath();
	// 				var coordinates = path.getCoordinates();
	// 				var totalDistance = 0;
					
	// 				// Calculate distance in chunks to avoid blocking
	// 				var chunkSize = 100;
	// 				var processChunk = function(startIndex) {
	// 					var endIndex = Math.min(startIndex + chunkSize, coordinates.length);
						
	// 					for (var i = startIndex + 1; i < endIndex; i++) {
	// 						totalDistance += ymaps.coordSystem.geo.getDistance(
	// 							coordinates[i-1],
	// 							coordinates[i]
	// 						);
	// 					}
						
	// 					if (endIndex < coordinates.length) {
	// 						setTimeout(function() {
	// 							processChunk(endIndex);
	// 						}, 0);
	// 					} else {
	// 						// Update UI after all calculations
	// 						$km = totalDistance > 100 ? Math.ceil(totalDistance / 1000) : 0;
	// 						data.overZoneOtherLength = totalDistance;
	// 						data.mkad = $km;
							
	// 						$('.calc-route__full').html(data.timeFull);
	// 						$('.calc-route__clear').html(data.timeClear);
	// 						$('.calc-route__zone').html('Расстояние: '+ $km + 'км');
	// 						$('.calc-route__zone').attr('data-dist', $km);
	// 						$('.calc-route').fadeIn(300);
							
	// 						// Update prices asynchronously
	// 						setTimeout(updatePrices, 0);
	// 					}
	// 				};
					
	// 				processChunk(0);
	// 			});

	// 			// Add route to map
	// 			if (route) {
	// 				map.geoObjects.remove(route);
	// 			}
	// 			route = multiRoute;
	// 			map.geoObjects.add(route);
	// 		}

	// 		// Separate price calculation into its own function
	// 		function updatePrices() {
	// 			return new Promise((resolve) => {
	// 				setTimeout(() => {
	// 					var cars = $('.calc-step__cars-inner .calc-car');
	// 					var newDist = Number($('.calc-route__zone').attr('data-dist'));
	// 					var dopPointsList = $('.calc-step__inputs').find('.input--address-to');
	// 					var dopPoints = dopPointsList.length;
	// 					var $clientType = $('input[name="Клиент"]:checked').val();
						
	// 					// Создаем ключ кэша
	// 					var cacheKey = `${newDist}_${dopPoints}_${$clientType}`;
						
	// 					// Проверяем кэш
	// 					if (priceCache[cacheKey]) {
	// 						updateUIWithPrices(priceCache[cacheKey]);
	// 						resolve();
	// 						return;
	// 					}
						
	// 					var prices = {
	// 						cars: {},
	// 						total: 0
	// 					};
						
	// 					// Рассчитываем цены для каждого автомобиля
	// 					cars.each(function(index, carEl) {
	// 						let $car = $(carEl);
	// 						let $carInput = $car.find('input');
	// 						let carId = $carInput.attr('id');
							
	// 						let currentPrice = Number($carInput.attr('data-base-price'));
	// 						let freeDist = Number($carInput.attr('data-base-distance'));
	// 						let extraKmPrice = Number($carInput.attr('data-extra-km-price'));
	// 						let extraPointPrice = Number($carInput.attr('data-extra-point-price'));
							
	// 						let newPrice = calculateCarPrice(currentPrice, freeDist, extraKmPrice, extraPointPrice, newDist, dopPoints, $clientType);
							
	// 						prices.cars[carId] = newPrice;
							
	// 						if ($car.hasClass('is-active')) {
	// 							prices.total = newPrice;
	// 						}
	// 					});
						
	// 					// Сохраняем в кэш
	// 					priceCache[cacheKey] = prices;
						
	// 					// Обновляем UI
	// 					updateUIWithPrices(prices);
						
	// 					resolve();
	// 				}, 0);
	// 			});
	// 		}

	// 		// Вспомогательная функция для расчета цены одного автомобиля
	// 		function calculateCarPrice(basePrice, freeDist, extraKmPrice, extraPointPrice, newDist, dopPoints, clientType) {
	// 			let price = Number(basePrice);
				
	// 			if (dopPoints > 1) {
	// 				price += (dopPoints * extraPointPrice) - extraPointPrice;
	// 			}
				
	// 			if (newDist > freeDist) {
	// 				price += (newDist - freeDist) * extraKmPrice;
	// 			}
				
	// 			if (clientType === 'Физлицо') {
	// 				price = price / 1.2;
	// 			}
				
	// 			return Math.ceil(price);
	// 		}

	// 		// Обновление UI с ценами
	// 		function updateUIWithPrices(prices) {
	// 			// Обновляем цены для каждого автомобиля
	// 			Object.entries(prices.cars).forEach(([carId, price]) => {
	// 				let displayPrice = price.toLocaleString('ru-RU');
	// 				$(`#${carId}`).closest('.calc-car').find('.calc-car__price').html('От ' + displayPrice + '\xa0₽');
	// 			});
				
	// 			// Обновляем общую цену
	// 			let displayTotal = prices.total.toLocaleString('ru-RU');
	// 			$('.calc-route_price__clear').html(displayTotal + '\xa0₽');
	// 			$('.calc-cost__value').html(displayTotal + '\xa0₽');
	// 		}

	// 		// Обновление маршрута
	// 		function updateEdgeRoute(value, param, callback) {
	// 			ymaps.geocode(value, {
	// 				boundedBy: city.bounds
	// 			}).then(function (point) {
	// 				if (!cityPoly.geometry.contains(point)) {
	// 					ymaps.route([city.center, point.geoObjects.get(0).geometry.getCoordinates()]).then(function (route) {
	// 						sleep(2000);
	// 						var edges = [];
	// 						ymaps.geoQuery(route.getPaths()).each(function (path) {
	// 							console.log(path);
	// 							var coordinates = path.geometry.getCoordinates();
	// 							for (var i = 1; i < coordinates.length; i++) {
	// 								edges.push({
	// 									type: 'LineString',
	// 									coordinates: [coordinates[i], coordinates[i - 1]]
	// 								});
	// 							}
	// 						});
	// 						var routeObjects = ymaps.geoQuery(edges).setOptions('visible', false).addToMap(map);
	// 						var objectsInCity = routeObjects.searchInside(cityPoly);
	// 						var dist = 0;
	// 						objectsInCity.each(function (path) {
	// 							dist += path.geometry.getDistance();
	// 						});
	// 						data[param] = route.getLength() - dist;
	// 						routeObjects.removeFromMap(map);
	// 						if (callback) callback();
	// 					});
	// 				} else {
	// 					data[param] = 0;
	// 					if (callback) callback();
	// 				}
	// 			});
	// 		};

	// 		// Скролл формы калькулятора
	// 		function initScroll(el) {
	// 			Scrollbar.init(el, {
	// 				alwaysShowTracks: true,
	// 				continuousScrolling: 'ontouchstart' in window || !sizeSM.matches ? true : false
	// 			});
	// 		}
	// 		initScroll($('.calc-step--two .calc-step__body')[0]);

	// 		// Отключение скролла формы на мобилах
	// 		function toggleScroll() {
	// 			var $scrollElements = $('.calc [data-scrollbar="true"]');
	// 			if ($scrollElements.length) {
	// 				if (!sizeMD.matches) {
	// 					$scrollElements.each(function () {
	// 						if ($(this).find('.scroll-content').length) Scrollbar.destroy(this);
	// 					});
	// 				} else {
	// 					$scrollElements.each(function () {
	// 						if (!$(this).find('.scroll-content').length) initScroll(this);
	// 					});
	// 				}
	// 			}
	// 		}
	// 		toggleScroll();
	// 		$(sizeMD).on('change', toggleScroll);

	// 		// Добавить/удалить поле адреса калькулятора
	// 		$('.calc-form').on('click', '.calc-input--address button', function () {
	// 			var $input = $(this).siblings('input');
	// 			var $inputParent = $input.parent();
	// 			var $inputParentIndex = $inputParent.index();
	// 			var $addressInputs = $('.calc-input--address');
	// 			var $stepBody = $input.closest('.calc-step__body');
	// 			if ($inputParent.is(':last-child:not(:nth-child(5))')) {
	// 				if ($input[0].checkValidity()) {
	// 					if ($addressInputs.length < 5) {
	// 						$inputParent.clone().appendTo($inputParent.parent()).find('.suggestions-wrapper').remove();
	// 						$addressInputs = $('.calc-input--address');
	// 						initCalcSuggest($('.calc-input--address:last-child input')[0], $addressInputs.length);
	// 						if (!Scrollbar.has($stepBody[0]) && $addressInputs.length > 2) initScroll($stepBody[0]);
	// 						toggleScroll();
	// 						setTimeout(() => {
	// 							if (Scrollbar.has($stepBody[0]) && $('.calc-route').is(':visible')) {
	// 								Scrollbar.get($stepBody[0]).scrollTo(0, $stepBody[0].scrollHeight, 600);
	// 							}
	// 						}, 50);
	// 						$inputParent.next().find('input').val('').trigger('focus');
	// 					}
	// 				} else {
	// 					$input[0].reportValidity();
	// 				}
	// 			} else {
	// 				var $lastInputParent = $('.calc-input--address:last-child');
	// 				var $lastInput = $lastInputParent.find('input');
	// 				if (!$lastInput[0].checkValidity() && $addressInputs.length > 2) {
	// 					$lastInputParent.remove();
	// 				} else {
	// 					$inputParent.remove();
	// 					data.addresses[$inputParentIndex] = '';
	// 					setAddress();
	// 				}
	// 				$addressInputs = $('.calc-input--address');
	// 				if (Scrollbar.has($stepBody[0]) && $addressInputs.length < 3) Scrollbar.destroy($stepBody[0]);
	// 			}
	// 		});

	// 		// Удалить пустое/невалидное поле адреса калькулятора
	// 		$('.calc-form').on('blur', '.calc-input--address input', function () {
	// 			var $input = $(this);
	// 			var $inputParent = $input.parent();
	// 			var $inputParentIndex = $inputParent.index();
	// 			var $addressInputs = $('.calc-input--address');
	// 			var $stepBody = $input.closest('.calc-step__body');
	// 			var $hoveredButtons = $addressInputs.find('button:hover');
	// 			if ($inputParent.find('.suggestions-hint').text() == 'Неизвестный адрес') {
	// 				$input.val('');
	// 			}
	// 			if (!$input[0].checkValidity() && !$hoveredButtons.length && $addressInputs.length > 2) {
	// 				$inputParent.remove();
	// 				if (typeof data.addresses[$inputParentIndex] != 'undefined') {
	// 					data.addresses[$inputParentIndex] = '';
	// 					setAddress();
	// 				}
	// 			}
	// 			$addressInputs = $('.calc-input--address');
	// 			if (Scrollbar.has($stepBody[0]) && $addressInputs.length < 3) Scrollbar.destroy($stepBody[0]);
	// 		});
	// 		// Расчет стоимости перевозки
	// 		function totalCostCalc() {
	// 			var $clientType = $('input[name="Клиент"]:checked').val();

	// 			var cars = $('.calc-step__cars-inner .calc-car');
	// 			var newDist = Number($('.calc-route__zone').attr('data-dist')); // общее расстояние
	// 			var dopPointsList = $('.calc-step__inputs').find('.input--address-to');
	// 			var dopPoints = dopPointsList.length;

	// 			cars.each(function(index, carEl) {
	// 				let $car = $(carEl);
	// 				let $carInput = $car.find('input');

	// 				let currentPrice = Number($carInput.attr('data-base-price'));
	// 				let freeDist = Number($carInput.attr('data-base-distance'));
	// 				let extraKmPrice = Number($carInput.attr('data-extra-km-price'));
	// 				let extraPointPrice = Number($carInput.attr('data-extra-point-price'));

	// 				let newPrice = currentPrice;

	// 				// Добавим доп. точки
	// 				if (dopPoints > 1) {
	// 					let dopPrice = (dopPoints * extraPointPrice) - extraPointPrice;
	// 					newPrice += dopPrice;
	// 				}

	// 				// Проверим превышение расстояния
	// 				if (newDist > freeDist) {
	// 					let extraDist = newDist - freeDist;
	// 					newPrice += extraDist * extraKmPrice;
	// 				}

	// 				if ($clientType == 'Физлицо') {
	// 					$fizprice = newPrice / 1.2
	// 					let displayPrice = Math.ceil($fizprice).toLocaleString('ru-RU');
	// 					$car.find('.calc-car__price').html('От ' + displayPrice + '\xa0₽');
	// 				} else {
	// 					let displayPrice = Math.ceil(Number(newPrice)).toLocaleString('ru-RU');
	// 					$car.find('.calc-car__price').html('От ' + displayPrice + '\xa0₽');
	// 				}
	// 			});

	// 			var $car = $('.calc-step__cars-inner .is-active').find('input');
	// 			var $new_dist = $('.calc-route__zone').attr('data-dist'); //общее расстояние
	// 			var $current_price = $($car).attr('data-base-price');
	// 			var $free_dist = $($car).attr('data-base-distance');
	// 			var $cof = $($car).attr('data-extra-km-price');
	// 			var $dop_points_price = $($car).attr('data-extra-point-price');
	// 			var $dop_points_list = $('.calc-step__inputs').find('.input--address-to');
	// 			var $dop_points = $dop_points_list.length;
				
	// 			if (Number($new_dist) < Number($free_dist)) {
	// 				if($dop_points > 1){
	// 					var dops = (Number($dop_points) * Number($dop_points_price)) - Number($dop_points_price)
	// 					$new_price = Math.ceil(Number($new_price)).toLocaleString('ru-RU');
	// 					$('.calc-cost__value').html($new_price + '\xa0₽');
	// 					var $new_price = Number($current_price) + Number(dops)
	// 				}else{
	// 					$new_price = Math.ceil(Number($new_price)).toLocaleString('ru-RU');
	// 					$('.calc-cost__value').html($new_price + '\xa0₽');
	// 					var $new_price = Number($current_price)
	// 				}
	// 			} else if (Number($new_dist) > Number($free_dist)) {
	// 				if ($dop_points > 1) {
	// 					var dops = (Number($dop_points) * Number($dop_points_price)) - Number($dop_points_price)
	// 					var $up = (Number($new_dist) - Number($free_dist)) * Number($cof)
	// 					var $new_price = Number($current_price) + Number($up) + Number(dops)
	// 				} else {
	// 					var $up = (Number($new_dist) - Number($free_dist)) * Number($cof)
	// 					var $new_price = Number($current_price) + Number($up)
	// 				}
	// 			}


	// 			if ($clientType == 'Физлицо') {
	// 				$fizprice = $new_price / 1.2
	// 				$fizprice = Math.ceil(Number($fizprice)).toLocaleString('ru-RU');
	// 				$('.calc-route_price__clear').html($fizprice + '\xa0₽');
	// 				$('.calc-cost__value').html($fizprice + '\xa0₽');
	// 			} else {
	// 				$new_price = Math.ceil(Number($new_price)).toLocaleString('ru-RU');
	// 				$('.calc-route_price__clear').html($new_price + '\xa0₽');
	// 				$('.calc-cost__value').html($new_price + '\xa0₽');
	// 			}
	// 		}

	// 		$('input[name="Клиент"]').on('change', totalCostCalc);

	// 		// Выбор авто по клику
	// 		$('.calc-car input').on('change', function () {
	// 			var $thisCar = $(this).closest('label');
	// 			var $otherCars = $thisCar.siblings();
	// 			$thisCar.addClass('is-active');
	// 			$otherCars.removeClass('is-active');
				
	// 			updatePrices();
	// 		});

	// 		// Выбор даты и времени
	// 		$('.calc-input--datetime input').flatpickr({
	// 			dateFormat: 'd.m.Y, H:i',
	// 			monthSelectorType: 'static',
	// 			disableMobile: true,
	// 			enableTime: true,
	// 			time_24hr: true,
	// 			minDate: 'today',
	// 			locale: 'ru',
	// 			onChange: function () {
	// 				$('.flatpickr-hour').trigger('blur');
	// 				$('.calc-step__action-btn').removeAttr('disabled');
	// 			},
	// 			onClose: function () {
	// 				$('.calc-step__action-btn').removeAttr('disabled');
	// 			}
	// 		});

	// 		// Переключение шагов калькулятора
	// 		$('.calc-step__action-btn').on('click', function () {
	// 			var $actionBtn = $(this);
	// 			var $calcStep = $actionBtn.closest('.calc-step');
	// 			var $stepBody = $calcStep.find('.calc-step__body');
	// 			var $formHereWe = $('.calc-form.new-template-steps').length;
	// 			var $widthScreen = window.innerWidth >= 992;
	// 			if (!$calcStep.is('.calc-step--four')) {
	// 				var $invalidInputs = $calcStep.find('input:invalid');
	// 				var $dateInput = $calcStep.find('input.flatpickr-input');
	// 				var $dateInputIsEmpty = $dateInput.length && $dateInput.val() == '';
	// 				if ($dateInputIsEmpty || $invalidInputs.length) {
	// 					if ($dateInputIsEmpty) {
	// 						$dateInput.trigger('click');
	// 						$actionBtn.attr('disabled', true);
	// 					} else if ($invalidInputs.length) {
	// 						$invalidInputs.first()[0].reportValidity();
	// 					}
	// 				} else {
	// 					if ($calcStep.is('.calc-step--one')) totalCostCalc();
	// 					if ($calcStep.is('.calc-step--two') && Scrollbar.has($stepBody[0])) {
	// 						var $scrollHeight = $stepBody[0].scrollHeight;
	// 						var $scrollTop = Scrollbar.get($stepBody[0]).scrollTop;
	// 						var $outerHeight = $stepBody.outerHeight() + 15;
	// 						if ($scrollHeight - $scrollTop > $outerHeight) {
	// 							Scrollbar.get($stepBody[0]).scrollTo(0, $stepBody[0].scrollHeight, 600);
	// 						} else {
	// 							if($formHereWe && $widthScreen){
	// 								$('.calc-step--one').hide();
	// 							}
	// 							$calcStep.hide().next().fadeIn(300);
	// 						}
	// 					}
	// 					else if($formHereWe && $calcStep.is('.calc-step--one') && $widthScreen){
	// 						$calcStep.next().fadeIn(300);
	// 					} else {
	// 						$calcStep.hide().next().fadeIn(300);
	// 					}
	// 				}
	// 			} else {
	// 				// Сброс формы и карты в конце
	// 				$('.calc-step').hide();
	// 				$('.calc-form').trigger('reset');
	// 				$('.calc-car:first-child input').trigger('change');
	// 				$('.calc-input--address:nth-child(n+3)').remove();
	// 				$('.calc-route').hide();
	// 				data = defaultData;
	// 				suggestArr = [];
	// 				setTimeout(() => {
	// 					if (mark) {
	// 						map.geoObjects.remove(mark);
	// 						mark = null;
	// 					}
	// 					if (route) {
	// 						map.geoObjects.remove(route);
	// 						route = null;
	// 					}
	// 					map.setCenter(city.center);
	// 					map.setZoom(9);
	// 					mark = new ymaps.Placemark(city.center, {}, {
	// 						iconLayout: 'default#image',
	// 						iconImageHref: iconStart,
	// 						iconImageSize: [78, 86],
	// 						iconImageOffset: [-44, -86]
	// 					});
	// 					map.geoObjects.add(mark);
	// 					if (!sizeSM.matches) {
	// 						var $scrollPos = $('.calc-step__cars-inner').position().left;
	// 						$('.calc-step__cars').scrollLeft($scrollPos);
	// 					}
	// 				}, 50);
	// 				$('.calc-step--one').fadeIn(300);
	// 			}
	// 		});

	// 		$('.calc-step__goback-btn').on('click', function () {
	// 			var $calcStep = $(this).closest('.calc-step');
	// 			$calcStep.hide().prev().fadeIn(300);
	// 		});
	// 	});
	// }

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

	// Карта на странице контактов
	if ($('.contacts-map').length) {
		var ymaps = window.ymaps;
		var myMap, myPlacemark;
		var $mapHeight = $('.contacts-map').height();
		var $zoomPosition = ($mapHeight / 2) - 30;
		ymaps.ready(function () {
			myMap = new ymaps.Map('map', {
				center: map.coords,
				zoom: 14,
				controls: [],
				behaviors: ['drag', 'dblClickZoom', 'rightMouseButtonMagnifier', 'multiTouch']
			}, {
				suppressMapOpenBlock: true,
				balloonPanelMaxMapArea: 0
			}),
				myPlacemark = new ymaps.Placemark(map.coords, {
					balloonContentHeader: 'Наш адрес:',
					balloonContentFooter: map.address
				}, {
					iconLayout: 'default#image',
					iconImageHref: map.icon,
					iconImageSize: (sizeSM.matches) ? [64, 64] : [48, 48],
					iconImageOffset: (sizeSM.matches) ? [-32, -64] : [-24, -48]
				});
			myMap.geoObjects.add(myPlacemark);
			myMap.controls.add('zoomControl', {
				size: 'small',
				position: {
					top: $zoomPosition,
					right: 15
				}
			});
			$(breakpoints).each(function () {
				$(this).on('change', function () {
					myPlacemark.options.set('iconImageSize', (sizeSM.matches) ? [64, 64] : [48, 48]);
					myPlacemark.options.set('iconImageOffset', (sizeSM.matches) ? [-32, -64] : [-24, -48]);
					if ($('.contacts-map').height() != $mapHeight) {
						$mapHeight = $('.contacts-map').height();
						$zoomPosition = ($mapHeight / 2) - 30;
						myMap.controls.remove('zoomControl').add('zoomControl', {
							size: 'small',
							position: {
								top: $zoomPosition,
								right: 15
							}
						});
					}
				});
			});
		});
	}


	// Инфо о заказе свернуть/развернуть
	$('.order-info__toggle').on('click', function () {
		$(this).toggleClass('is-active');
		$('.order-info__list').slideToggle(250);

		if($(this).hasClass("is-active")){
			$(this).text("Скрыть");
		}
		else{
			$(this).text("Показать");
		}
	});
	$(sizeSM).on('change', function () {
		$('.order-info__toggle').removeClass('is-active');
		$('.order-info__list').removeAttr('style');
	});


	// Загрузка документов
	if ($('.order-documents').length) {
		pdfjsLib.GlobalWorkerOptions.workerSrc = workerSrc;
		$('.documents-loader').each(function (i) {
			var $loader = $(this);
			var $input = $loader.find('input');
			var $dropArea = $input.parent();
			var $filesList = $loader.find('ul');
			var dt = new DataTransfer();
			$loader.attr('id', 'loader' + i);
			// Добавление файлов в список
			function addToList(file) {
				var reader = new FileReader();
				reader.readAsDataURL(file);
				$(reader).on('load', function (e) {
					var li = `<li class="documents-loader__file">
						<div class="documents-loader__file-img">
							<a href="${e.target.result}"><img src="${e.target.result}" alt=""></a>
						</div>
						<div class="documents-loader__file-name">${file.name}</div>
						<div class="documents-loader__file-size">${Number((file.size / 1048576).toFixed(1)).toLocaleString('ru-RU')} Мб</div>
						<button class="documents-loader__file-remove" type="button">Удалить</button>
					</li>`;
					$filesList.append(li);
				});
			}
			// Сжатие файлов и добавление в инпут
			function addFiles(files) {
				var promises = [];
				$(files).each(function (i, file) {
					promises.push(
						new Promise(function (resolve) {
							// Обработка PDF
							if (file.type == 'application/pdf') {
								var url = URL.createObjectURL(file);
								pdfjsLib.getDocument(url).promise.then(function (pdf) {
									var totalPages = pdf.numPages;
									var pageCounter = 1;
									for (var pageNumber = 1; pageNumber <= totalPages; pageNumber++) {
										pdf.getPage(pageNumber).then(function (page) {
											var viewport = page.getViewport({ scale: 2 });
											var canvas = document.createElement('canvas');
											var context = canvas.getContext('2d');
											canvas.height = viewport.height;
											canvas.width = viewport.width;
											var renderContext = { canvasContext: context, viewport: viewport };
											var renderTask = page.render(renderContext);
											renderTask.promise.then(function () {
												canvas.toBlob(function (blob) {
													var fileName = file.name.replace('.pdf', '');
													fileName = totalPages > 1 ? fileName + '_' + pageCounter++ : fileName;
													fileName = fileName + '.jpg';
													var minFile = new File([blob], fileName, { type: 'image/jpeg' });
													dt.items.add(minFile);
													addToList(minFile);
													var i = totalPages > 1 ? 1 : 0;
													if (totalPages == pageCounter - i) resolve(minFile);
												}, 'image/jpeg', 0.8);
											});
										});
									}
								});
								// Обработка JPEG/PNG
							} else {
								var img = new Image();
								img.src = URL.createObjectURL(file);
								img.onload = function () {
									URL.revokeObjectURL(this.src);
									var [newWidth, newHeight] = calculateSize(img, 4000, 4000);
									var canvas = document.createElement('canvas');
									canvas.width = newWidth;
									canvas.height = newHeight;
									var ctx = canvas.getContext('2d');
									ctx.drawImage(img, 0, 0, newWidth, newHeight);
									canvas.toBlob(function (blob) {
										var fileName = file.name.replace('.png', '.jpg');
										var minFile = new File([blob], fileName, { type: 'image/jpeg' });
										dt.items.add(minFile);
										addToList(minFile);
										resolve(minFile);
									}, 'image/jpeg', 0.8);
								};
							}
						})
					);
				});
				Promise.any(promises).then(function () {
					$filesList.parent().fadeIn(250);
				});
				Promise.all(promises).then(function () {
					$input.prop('files', dt.files).addClass('not-empty');
					$().fancybox({
						loop: true,
						backFocus: false,
						selector: '#' + $loader.attr('id') + ' .documents-loader__file-img'
					});
				});
			}
			// Добавление файлов через Drag & Drop
			$dropArea.on('drag dragstart dragend dragover dragenter dragleave drop', function (e) {
				e.preventDefault();
				e.stopPropagation();
			}).on('dragover dragenter', function () {
				$dropArea.addClass('is-dragover');
			}).on('dragleave dragend drop', function () {
				$dropArea.removeClass('is-dragover');
			}).on('drop', function (e) {
				var files = e.originalEvent.dataTransfer.files;
				var formats = ['image/jpeg', 'image/png', 'application/pdf'];
				var validFiles = Array.from(files).filter((file) => formats.includes(file.type));
				if (files.length == validFiles.length) {
					addFiles(files);
				} else {
					popupMessage('error');
				}
			});
			// Добавление файлов через кнопку
			var prevFiles = null;
			$input.on('click', function () {
				prevFiles = $input.prop('files');
			});
			$input.on('change', function () {
				var files = $input.prop('files');
				var formats = ['image/jpeg', 'image/png', 'application/pdf'];
				var validFiles = Array.from(files).filter((file) => formats.includes(file.type));
				if (files.length == validFiles.length) {
					addFiles(files);
				} else {
					if (prevFiles != null) $input.prop('files', prevFiles);
					popupMessage('error');
				}
			});
			// Удаление файлов
			$filesList.on('click', 'li button', function () {
				var $button = $(this);
				var $listItem = $button.parent();
				var $fileIndex = $listItem.index();
				dt.items.remove($fileIndex);
				$input.prop('files', dt.files);
				$listItem.remove();
				if (!$filesList.find('li').length) {
					$filesList.parent().hide();
					$input.removeClass('not-empty');
				}
			});
		});
		$('.documents-loader__input-btn').on('click', function () {
			$(this).siblings('input').trigger('click');
		});
		// Максимальное разрешение JPEG/PNG
		function calculateSize(img, maxWidth, maxHeight) {
			var width = img.width;
			var height = img.height;
			if (width > height) {
				if (width > maxWidth) {
					height = Math.round((height * maxWidth) / width);
					width = maxWidth;
				}
			} else {
				if (height > maxHeight) {
					width = Math.round((width * maxHeight) / height);
					height = maxHeight;
				}
			}
			return [width, height];
		}

		// Отправка документов на сервер
		$('.documents').on('submit', function () {
			var $thisForm = $(this);
			popupMessage('loading');
			setTimeout(() => {
				$thisForm.trigger('reset');
				$('.documents-loader__files').hide();
				$('.documents-loader__file').remove();
				$('.documents-loader__input-field').removeClass('not-empty');
				$('.documents-status').addClass('added');
				$.fancybox.getInstance().addContent({
					src: '#thanks',
					type: 'inline',
					touch: false,
					arrows: false,
					toolbar: false,
					infobar: false,
					keyboard: false,
					smallBtn: false,
					backFocus: false,
					autoFocus: false,
					animationEffect: 'drop',
					animationDuration: 450
				});
				$.fancybox.getInstance().next(450);
			}, 3000);

			// var formData = new FormData();
			// var files = $('[name="files1[]"]').prop('files');
			// $.each(files, function (i, file) {
			// 	formData.append('ТН / ТТН / УПД', file);
			// });
			// for (var pair of formData.entries()) {
			// 	console.log(pair[0] + ', ' + pair[1]);
			// }
			// $.ajax({
			// 	url: 'upload.php',
			// 	type: 'POST',
			// 	data: formData,
			// 	processData: false,
			// 	contentType: false,
			// 	success: function (data) {
			// 		console.log(data);
			// 	}
			// });

			return false;
		});

	}



	$('.calc-sub-btn').click(function(){
		// Переменные для заполнения
		var name = $('.form_name')
		var tel = $('.form_tel')
		var comment = $('.form_comment')
		var places = $('.form_places')
		var type = $('.form_type')
		var dist = $('.form_dist')
		var time = $('.form_time')
		var price = $('.form_price')
		var date = $('.form_date')
		var type_gruz = $('.form_type_gruz')
		var ves =  $('.form_ves')
		var size =  $('.form_size')
		var order = $('.form_order')
		//Пересменные формы
		var s_name = $('.s_name').val()
		var s_tel = $('.s_tel').val()
		var s_comment = $('.s_comment').val()
		var s_places = ""
		var start = $('.start_place').val()
		var points = $('.input--address-to')
		var points_list = ''
		for(i=0;i<points.length;i++){
			poin = $(points[i]).find('input').val()
			points_list = points_list + ' , ' + poin
		}
		var s_places = start + " / " + points_list
		var s_type = $('.calc-step__cars-inner .is-active .calc-car__type').text()
		var s_dist = $('.calc-route__zone').text()
		var s_time = $('.calc-route__full').text()
		var s_price = $('.calc-cost__value').text()
		var s_date = $('.s_date').val()
		var s_type_gruz = $('.s_type_gruz').val()
		var s_ves =  $('.s_ves').val()
		var s_size =  $('.s_size').val()

		var s_order = $('.s_order').find('input')
		var s_order_val = ''
		for(r=0;r<=s_order.length;r++){
			or = $(s_order[r]).prop('checked')
			if(or == true){
				s_order_val = $(s_order[r]).val()
			}
		}

		$(name).val(s_name)
		$(tel).val(s_tel)
		$(comment).val(s_comment)
		$(places).val(s_places)
		$(type).val(s_type)
		$(dist).val(s_dist)
		$(time).val(s_time)
		$(price).val(s_price)
		$(date).val(s_date)
		$(type_gruz).val(s_type_gruz)
		$(ves).val(s_ves)
		$(size).val(s_size)
		$(order).val(s_order_val)

		$('.calc_form_btn ').click()
	})



	$('.feedback-form').submit(function(e){
		e.preventDefault()

		var name = $('.feedback_name').val()
		var tel = $('.feedback_tel').val()

		$('.f_name').val(name)
		$('.f_tel').val(tel)

		$('.f_form_btn').click()
	})

	$('#order').submit(function(e){
		e.preventDefault()

		var name = $('.order_name').val()
		var tel = $('.order_tel').val()

		$('.o_name').val(name)
		$('.o_tel').val(tel)

		$('.o_form_btn').click()
	})

	$('#calc').submit(function(e){
		e.preventDefault()

		start = $('#calc').find('.start').val()
		var s_places = ""
		var points = $('#calc').find('.input--address-to')
		var points_list = ''
		for(i=0;i<points.length;i++){
			poin = $(points[i]).find('input').val()
			points_list = points_list + ' , ' + poin
		}
		var s_places = start + " / " + points_list
		var name = $('#calc').find('.name').val()
		var type = $('#calc').find('.type').val()
		var tel = $('#calc').find('.tel').val()

		$('.tpoints').val(s_places)
		$('.tname').val(name)
		$('.ttype').val(type)
		$('.ttel').val(tel)

		$('.calcform_btn').click()
	})
	$('#calc_2').submit(function(e){
		e.preventDefault()

		start = $('#calc_2').find('.start').val()
		var s_places = ""
		var points = $('#calc_2').find('.input--address-to')
		var points_list = ''
		for(i=0;i<points.length;i++){
			poin = $(points[i]).find('input').val()
			points_list = points_list + ' , ' + poin
		}
		var s_places = start + " / " + points_list
		var name = $('#calc_2').find('.name').val()
		var type = $('#calc_2').find('.type').val()
		var tel = $('#calc_2').find('.tel').val()

		$('.tpoints').val(s_places)
		$('.tname').val(name)
		$('.ttype').val(type)
		$('.ttel').val(tel)

		$('.calcform_btn').click()
	})



	$('#back_first').click('func')
});

$(window).on('load resize', function() {
    if ($(window).width() < 461) {
		$('#first').click(function(){
			$('.calc-map').hide()
		})
		$('#back_first').click(function(){
			$('.calc-map').show()
		})
    }
});


jQuery(document).ready(function($) {
    // Показ/скрытие попапа при клике на кнопку
	$('#header-city__toggle').on('click', function(e) {
		e.stopPropagation();
		
		const $popup = $('#city-popup');
		if ($popup.is(':visible')) {
		$popup.slideUp();
		} else {
		// Позиционируем под кнопкой
		const offset = $(this).offset();
		const height = $(this).outerHeight();

		$popup.css({
			top: "100%",
			left: 0
		}).slideDown(function () {
			// Инициализация после отображения
			$('#city-popup .input--city input').each(function () {
			initFormSuggestCity(this);
			});
		});
		}
	});

	// Закрытие при клике вне попапа
	$(document).on('click', function() {
		$('#city-popup').slideUp();
	});

	// Остановить закрытие при клике внутри попапа
	$('#city-popup').on('click', function(e) {
		e.stopPropagation();
	});

    // Закрытие попапа
    $('#close-popup').on('click', function() {
        $('#city-popup').fadeOut();

		
    });

	// Подсказки адресов для инпутов форм
		function initFormSuggestCity(input) {
			$(input).suggestions({
				token: '2267571a9b74e90c77a347a17eca6186b05a0a90',
				type: 'ADDRESS',
				bounds: "city",
				onSelect: function onSelect(suggestion) {
					input.value = suggestion.data.city;
					// Отправка Ajax-запроса для обновления города в сессии
					$.ajax({
						url: ajaxurl,  // Встроенная переменная WordPress для Ajax
						method: 'POST',
						data: {
							action: 'update_city_session',  // Действие на сервере
							city: suggestion.data.city
						},
						success: function(response) {
							// Закрытие попапа и перезагрузка страницы
							$('#city-popup').fadeOut();
							location.reload();  // Перезагружаем страницу для обновления контента
						}
        			});
				}
			});
			$(input).attr('autocomplete', 'off'); 
		};

});



